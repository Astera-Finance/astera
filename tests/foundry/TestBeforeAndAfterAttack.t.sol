// SPDX-License-Identifier: BUSL-1.1
pragma solidity ^0.8.0;

import {Test} from "forge-std/Test.sol";
import {console2} from "forge-std/console2.sol";
import {AsteraDataProvider2, UserReserveData} from "contracts/misc/AsteraDataProvider2.sol";
import {ILendingPoolConfigurator} from "contracts/interfaces/ILendingPoolConfigurator.sol";
import {
    ILendingPoolAddressesProvider
} from "contracts/interfaces/ILendingPoolAddressesProvider.sol";
import {IERC20Detailed} from "contracts/dependencies/openzeppelin/contracts/IERC20Detailed.sol";
import {ILendingPool} from "contracts/interfaces/ILendingPool.sol";
import {MiniPoolV3} from "contracts/protocol/core/minipool/MiniPoolV3.sol";
import {LendingPoolV2} from "contracts/protocol/core/lendingpool/LendingPoolV2.sol";
import {LendingPoolV3} from "contracts/protocol/core/lendingpool/LendingPoolV3.sol";
import {IAToken} from "contracts/interfaces/IAToken.sol";
import {IVariableDebtToken} from "contracts/interfaces/IVariableDebtToken.sol";
import {Errors} from "contracts/protocol/libraries/helpers/Errors.sol";
import {IAERC6909} from "contracts/interfaces/IAERC6909.sol";
import {IMiniPoolAddressesProvider} from "contracts/interfaces/IMiniPoolAddressesProvider.sol";
import {IMiniPool} from "contracts/interfaces/IMiniPool.sol";
import {IMiniPoolConfigurator} from "contracts/interfaces/IMiniPoolConfigurator.sol";
import {AggregatedMiniPoolReservesData} from "contracts/interfaces/IAsteraDataProvider2.sol";
import {Liquidator} from "contracts/misc/Liquidator.sol";
import {IRouter} from "tests/foundry/interfaces/IRouter.sol";

import {IPair} from "tests/foundry/interfaces/IPair.sol";

import {IOracle} from "contracts/interfaces/IOracle.sol";

import {DataTypes} from "contracts/protocol/libraries/types/DataTypes.sol";

import {
    ReserveConfiguration
} from "contracts/protocol/libraries/configuration/ReserveConfiguration.sol";

contract TestBeforeAndAfterAttack is Test {
    using ReserveConfiguration for DataTypes.ReserveConfigurationMap;
    address constant DATA_PROVIDER = 0xE4FeC590F1Cf71B36c0A782Aac2E4589aFdaD88e;

    address constant LENDING_POOL_CONFIGURATOR = 0x5af0d031A3dA7c2D3b1fA9F00683004F176c28d0;
    address constant ADMIN = 0x7D66a2e916d79c0988D41F1E50a1429074ec53a4;
    address constant EMERGENCY = 0xDa77d6C0281fCb3e41BD966aC393502a1C524224;
    address constant LIQUIDATOR = 0x71C4ebBa016Df7C4B4b23Cf7e8Cc13ef36ddA3a8;

    address constant LENDING_POOL_ADDRESSES_PROVIDER = 0x9a460e7BD6D5aFCEafbE795e05C48455738fB119;
    address constant LENDING_POOL_PROXY = 0x17d8a5305A37fe93E13a28f09c46db5bE24E1B9E;

    address constant MINI_POOL_ADDRESS_PROVIDER = 0x9399aF805e673295610B17615C65b9d0cE1Ed306;
    address constant MINI_POOL_CONFIGURATOR = 0x41296B58279a81E20aF1c05D32b4f132b72b1B01;

    address constant ORACLE = 0xd971e9EC7357e9306c2a138E5c4eAfC04d241C87;

    address constant USDC = 0x176211869cA2b568f2A7D4EE941E073a821EE1ff;
    address constant WETH = 0xe5D7C2a44FfDDf6b295A15c148167daaAf5Cf34f;
    address constant USDT = 0xA219439258ca9da29E9Cc4cE5596924745e12B93;
    address constant WBTC = 0x3aAB2285ddcDdaD8edf438C1bAB47e1a9D05a9b4;
    address constant ASUSD = 0xa500000000e482752f032eA387390b6025a2377b;
    address constant MUSD = 0xacA92E438df0B2401fF60dA7E4337B687a2435DA;
    address constant LINEA = 0x1789e0043623282D5DCc7F213d703C6D8BAfBB04;
    address constant REX33 = 0xe4eEB461Ad1e4ef8b8EF71a33694CCD84Af051C4;

    address constant WSTETH = 0xB5beDd42000b71FddE22D3eE8a79Bd49A568fC8F;
    address constant WEETH = 0x1Bf74C010E6320bab11e2e5A532b5AC15e0b8aA6;
    address constant EZETH = 0x2416092f143378750bb29b79eD961ab195CcEea5;

    address constant ASUSDC = 0xcb338D6b4547479F5D11A68572F89A4F3cCa7347;
    address constant ASWETH = 0x78469e135ac38437cD4DfBf096b83f100EcF3260;
    address constant ASUSDT = 0xD66aD16105B0805e18DdAb6bF7792c4704568827;
    address constant ASWBTC = 0x4Ee17d24fBd633c128Fb5068d450e16D0Ff45108;
    address constant ASASUSD = 0x2a81FD13C0e101FCb96cB6fD996258e2b20d91d1;
    address constant ASMUSD = 0xb38064EF885551ef996c885Eb8Ea80Da5cC1c9f2;

    address constant VDUSDC = 0x026152F78c6b716DA19C2BFfF474d0F9e2D2fBE9;
    address constant VDWETH = 0x2694FcCadf98621e5dA7a8946a545BBce2d51693;
    address constant VDWBTC = 0xF4167Af603fBA02623950223383b41061731EcEF;
    address constant VDUSDT = 0x1Cc0D772B187693Ebf20107E44aC7F1029578e1F;
    address constant VDASUSD = 0xa04C8b74C9B1319DB240157cFe14504844debDf2;
    address constant VDMUSD = 0x20d2312769D6d9eAADBb57a3eEA44592440cd6C9;

    address constant wasWBTC = 0x7dfd2F6d984CA9A2d2ffAb7350E6948E4315047b;
    address constant wasWETH = 0x9A4cA144F38963007cFAC645d77049a1Dd4b209A;
    address constant wasUSDC = 0xAD7b51293DeB2B7dbCef4C5c3379AfaF63ef5944;
    address constant wasUSDT = 0x1579072d23FB3f545016Ac67E072D37e1281624C;

    mapping(address => uint256) public collateralAssetSum;
    mapping(address => uint256) public debtAssetSum;

    // address[] public allUsers = [
    //     0xbeb15caee71001d82F430E4deda80e16dDf438Db,
    //     0x97D37E8B619cF4C6145da456766CA4FA157292D3,
    //     0xF1D6ab29d12cF2bee25A195579F544BFcC3dD78f,
    //     0x7D66a2e916d79c0988D41F1E50a1429074ec53a4,
    //     0xcd69567080Dccad1Afe61aCc022c0A7164B29AB4,
    //     0x61cd1eB8434aaBDD38A0Abd62Dc8665e958E41d1,
    //     0xEdeA7aAF2036686b01a5c1D1Fd09a86042BB4189,
    //     0x7b65bE6FDA7107D3AB7959ee3c81BbEc7ea7e833,
    //     0xFFbA0Ce4b97EaE5f865B84B55ec1094dA5245039,
    //     0x510A269A93736B5B5E3C2133e8f2e7D829ca3Fec,
    //     0x19Fa956048DF9A0024d4E65dAB6422f99eDb125F,
    //     0x1ac686c047283D7EF65345475A2633b6904ECa4d,
    //     0x8c9Dffe11BbE2cE25b12Af35C9ff425492fbC9A2,
    //     0xFb9Cbb2FEDEc281B80AeF79Cc1f39d547EFB956e,
    //     0x5EeDe1C45E4401d7D95E55446dAd71B511328534,
    //     0x391542D068952fdbE793fCA253A948329F2880c7,
    //     0x11315Cce8f009e4CB4234FFEAF2E860b84E5b0f6,
    //     0x14b35EA598a18e171a8f1e724c356F83fB4A0F18,
    //     0x360c0eABAA89eb98Bb1Fc741bC4B3198D167A883,
    //     0x67dc0cAd9F5a12a4e5FaA368A6Aa7CD7FB6259C2,
    //     0x8B4441E79151e3fC5264733A3C5da4fF8EAc16c1,
    //     0xF2Cf9d7513A2F6EAAe9d82b95B3c40D0efebE33B,
    //     0x529407C4e9584701253D93DDa4686a630Ada00e5,
    //     0x8a81DAFbFA575C9992eb649bA3F370197F7De9b9,
    //     0xEc8676ECF9Acf53Bd0CBbcA0f95108730bc49c39,
    //     0x1014A66402Ff5b51d86a527da1dbe96343Bd9D95,
    //     0xc8B19839ae371bd541F20B15c3A3CB82BFB6A6C6,
    //     0x0f14588c202d216EE5731de905390516F5714E95,
    //     0x0CeCc8F202CDd0bA7efA81F5f9518927D31B36d1,
    //     0xC3057B4F07e20CAaeF063075D05344C9a9E0452e,
    //     0x972698bF61E2377B5c45B3038D85d04981ddb48c,
    //     0x687baA6fC8ceD1e83e27CAA6334dB0D9acE61e7f,
    //     0x8A0E282923DF54FbAe68f0CA7b8C859eDbc2f11e,
    //     0xa6fbe8f447fe74D39C2D904D521a2819C4BA7C33,
    //     0xaeD399a5625aE5b3B5E1a7cE725F62E0f369F4F8,
    //     0xae3Ee333196aa374FAdc99b330868d87Ae57b246,
    //     0x472Bf5Ff7b96033BD203b360403A0649A908DBE4,
    //     0xd52929B69680A6f74D2eB9c8F1ef482f37b1b32B,
    //     0x55FA15d71Ef24a8aeD9F89a1fD19cB55B5737e49,
    // 0x8f09e6f29ED099288E824BCa5BF34e4D3B40CDF4,
    // 0x88f9B5E019e959B3380c67AD94379eFAbE994825,
    // 0x2a377028DF028828dEbC0De6B0280AFeA007a7CE,
    // 0x95f3A8dc78929F065544fbD3caA0FA3Bd9CD3e7C,
    // 0x8699D8817356f3f55C25E5216322a82f1f7942D7,
    // 0x013a1866c1C6E7BfD99178D5de49F2830b5Caf87,
    // 0x35fE83086417ac7EA4e9E80D1D3369C455c17005,
    // 0xCE29ECB0D2d8c8f0126ED923C50A35cFb0B613A8,
    // 0xC6CE31DaFf9175a30FCEf932180b0A783cEAdD06,
    // 0x329CfE850FF4CF637aa2353ef2D3672156E54d6C,
    // 0x50D229b19Afe670EF4adF092d8a66Be0bE471039,
    // 0xD95451B9F51bfE8f37BbF2165C4aA37F9BD7Cd28,
    // 0xBeC88d61cd94Da3Ee08F844c536140C1D10095c5,
    // 0x54d765404f9D4FF2bD6334a395Ef4CC042912c87,
    // 0xDf0EF4d11Ac2a77D7155a83ED9653e1E10725C4e,
    // 0xa7AB43295A9bddE0d185049c45ED5FfA1758c190,
    // 0x8dF59E597266bd3FE4C817aC983D2B57dFa70131,
    // 0x7374E3e9C57b7063dF9216Fe46b179747e9Ae2c6,
    // 0xbfD9A3b20fFcb0F4ac06884DEE5DaE484915F5c9,
    // 0xc7F354b172e53c0dfFA8Db17b028F634CD2EFCBF,
    // 0x0D8A31bdce93d40978171f762C0247F108903b0D,
    // 0x78CB7537E0b9a6bDe79654ceF4a6A2F4A7f3B514,
    // 0xc091CC903828866E4D0087621d92F619107Afce2,
    // 0x56D7A1BB1405db9c4b9b06e2610d8b25d068F308,
    // 0xe0A86AFB73c0922A50D4A985A25507EcDA8a9B51,
    // 0xA72Cf13C434Ae89ca6ad0802e38074345dF0a882,
    // 0x9aA9BaAf1e4Cfea1560cC5dD19f4351b49E299F4,
    // 0x9eDA9317771080eC5c5Da3b88b4D349103D18EEc,
    // 0xC20C94022182505A0c73D1F235Acb86647Bda29E,
    // 0x4dAf8ce9D729ca4F121381ec4B22123627C1C004,
    // 0x098fFf7E82dAd4488f94d7Dbe1415dd913066355,
    // 0xcaFa3E48Ad50120358072Befe591e00c7118d1B9,
    // 0xC55720f140337755346ca0bCCB5ab3e2E07D27c3,
    // 0xcF89b2628925F9c97cB2C2bB47dd59e060C50f62,
    // 0x21bC7fBf89B07E318dcE55676BfF0c3FF5EDB948,
    // 0x0A83985E4A6E8Dae2B67beD4f2d9268f6806Ce00,
    // 0xb794A8aa430907390B13C24932fe5C982B894DAA,
    // 0xDD0c16db6ED4f670BB4dC7235ab6b7C100773b88,
    // 0x72727d612CD162c30f84B579662a9bDe34481aE7,
    // 0x4fd1Cb0c9661E1886734e7ab9C0197A37cb1A02C,
    // 0x82F9C16D5ADA0C406aA432b4B79A15F6F7725Ae5,
    // 0xC8CaEc7aE8B36676c5C60D11423C6dAC8343EB19,
    // 0x505BDde1984E5b76F6455D533D0D116Af4d061bc,
    // 0xA84fE466486223FA9BbA2dD3ecFb5C1100311711,
    // 0x9fD6b6ccad34803fdf62DdDb3f23BFC5ec4c2f04,
    // 0x908Fd947485FA2501273c81CB4b639eE17045468,
    // 0xCf571e890c3F319978EDA4Fe9f62dBe9cc7E3Aa0,
    // 0xCAfc58De1E6A071790eFbB6B83b35397023E1544,
    // 0xb79185Aa49426D57fF9e9F96c276E559549AA732,
    // 0xDD0CDF8D98d9Ad3ADfaa49AaECD444Bfa01d9C9a,
    // 0xB3bfB32977cFd6200AB9537E3703e501d8381c9B,
    // 0x7BFEe91193d9Df2Ac0bFe90191D40F23c773C060,
    // 0xABa29a215Ae420ddfa73929fcD958e5d3ba11D17,
    // 0xAC1c487f78564dfFB2c94D6f28EdF04E18843004,
    // 0xeb7846Ad58FBDaC651830d5370a94488c06F282d,
    // 0x40D0759C8e8330f46c0548743FA239A9d9190Fee,
    // 0xfae5Ba0a469179C88366EC33202e7bF24C649b01,
    // 0x001A794b0973AA5384ae9B7140A767782c038af8,
    // 0xAe5905De19D8E65b45D8179F71C72AF8018721CD,
    // 0x789498eE77215b80d201A814228fA7f248c3be18,
    // 0xb11903Ec9E1036F1a3FaFe5815E84D8c1f62e254,
    // 0x031F72dEB03C509af42624ddcD1f63fce5eCb220,
    // 0x1eC8F94b0ef0Dc6a9Ff923dfdf2523f4456CdFfD,
    // 0xc9C384a9E7e28f7Ef55903eb90947fe3ce71D475,
    // 0xE165c34D3c5eCf7dF2aFF2955FE3A7Bd7CB38b4C,
    // 0x7455b2b0fA3E38051cc1744b7f4a49d34A7C824c,
    // 0x8f7746510b6CDB91AcE7F6749fAd2edA44Da1171,
    // 0x4A219402d71BF58114F1b699654aCF388E2dA672,
    // 0x25aFBD53E030f77309F2008e4214179533B67E11,
    // 0x553A7130D1b84651327865e0c623e21B9E97D447,
    // 0x655301eB3992fA35fF6fec91567240310a9756A6,
    // 0x2E11092aFafce07F68A2579b76139233b1ba6Caf,
    // 0x57F6F77da955C8FA89f3CF7973a1fB8054B56204,
    // 0xA4c63A2E8D0556dDB36C6544625284c663642387,
    // 0x126FF8faBeC84EF8a96F25dD0C2668fB9b7E7088,
    // 0x026F34De8aD8Ac421f85C7Cbb3d13f04529aA7b8,
    // 0xaF0114811527B29E07B374EcA3114dBE20992c79,
    // 0xf2Bc825FB466136d00571B496E6EB1a601679919,
    // 0x49F63B254EA9043E57678C13E06Aef257fab45C1,
    // 0x47CF3216065840b831c343bB3445d753204cdBBb,
    // 0xA7B729c880512A177c4B92Ab632E70988fb47462,
    // 0x57354e7567331d2974De08aC283d7f5663eCCa93,
    // 0x598Eec18F8412e326e1Caa73d91cAEAD065651e1,
    // 0xE3bB042f9Cc751AFAF7C14FC0b2848FAE17CB08a,
    // 0x58f1101f3632f1D0544197351FbdEd673f4b43F1,
    // 0xdB2B9D473014d8c6A5E55dA92205199457Ba6624,
    // 0x1C1795bffeDa25De01A7C21c88b49D9592B0598D,
    // 0x6270df891fC56b3f4D75361185A31194b29AFD5D,
    // 0x9C9553CD0c8673651A36e5E11C4989bb629D4067,
    // 0x9e3aE00085e9f5c302bEfEC347d6a0560DE72C6E,
    // 0xDEAdF06F9Cd85CBc94Ffd9af05db9C24e32B7820,
    // 0x5d6BB3519cc1f484aAe443D4b0650F0af8a3c0E6,
    // 0xC9EEF46E1AB9C4eEdC7B7cBd36Dc37C1A0EB1f75,
    // 0xa056C95d109E69667f23B0bd4c5b94A58CBB412a,
    // 0x6649449f075A8F6Aa56Efe43ab5c45B8ca0dFe2C,
    // 0xE451DC0948F33B1261c585f0DB84cca9Ab69F3A4,
    // 0x1B5db5c065d7507DBF65032a1835e4a7B633E67b,
    // 0xC2Fa91EFdE9fd71b3AC5912f7c7A48D4680847ec,
    // 0x4316c8275A46878837a0AaE31E5741E6C0665d72,
    // 0x80ff9275306dCe02b9779F1b9336112CBf850fcb,
    // 0x21914aB1b8c3ABc79f6312148b3506DA965D396b,
    // 0xC0E88f859dE5c9EBDDDd7e5C4c46ab7fcECd65d7,
    // 0x607E73C236983D56Bdfc52753016932Bf0eAd90E,
    // 0x4071484638157875C8E2D74b066135Dd9b12e25b,
    // 0x3C4524481a34551fc5Aa239250F07A986Ed2c2E1,
    // 0x3Da8cADa0F3801D13eb0748ab4f5f6eE0F450690,
    // 0xd6f8f76EF075e9B585a847B730C0531C1354671A,
    // 0x303F2d38AB911296DEcA9dC19968a854d9cBCAdC,
    // 0x477dE3668C728adb0045f0BBe06eE9d0230c1564,
    // 0x7841708EE45e96464bbd5Ec53f2f0b5671e720C2,
    // 0xBf4295753a763615B87024f9Dc234Df2748c512A,
    // 0x4C92Ab257222BCd47E299aDdF268D696Bb3B00d7,
    // 0x8dF3e4806A3320D2642b1F2835ADDA1A40719c4E,
    // 0x9BBCa2632Dfcaa1962b18275086338fc8AC47DA2,
    // 0x68f861D975594e3a36281bfb5E5e6A9BE67C3359,
    // 0x49a5492FDFe5AcC966dD5f41310dfDfe8dAA349C,
    // 0xF514E198143Ed375aD99c224059a3BC301766adB,
    // 0x81B74321c33538e54F1690add3f874f68Dab5921,
    // 0xBa731Fd3431dE103f16e6D9B0cC62ff74107ff41,
    // 0x02dCFB1d14bB6D36b9126eDe6A8CCb3c5940326E,
    // 0x43B2D03C55418c7CAf4Bd137B115f0eeB15B6D4c,
    // 0x17748cB3aa5528C4eaC514f8b6E8FAdef13B29b4,
    // 0x1E4083200704948eEC75feD99422BB718e1A269C,
    // 0x3b6239114d84A25D4CE995B344d399DD0a0ed4f6,
    // 0x6aa0ae3b73b30DcA351fC640380e87EcEA6bE499,
    // 0x5CB97ec856d779cF7b130408D18CC802824ccf5F,
    // 0x6e4aeB2Af9CE3b67116d8B19E6f1CA6b318Fc629,
    // 0x8011d0c9DB37CBCF7cA781918B4AD0cB50A177D4,
    // 0x4c7eabe657187D2c8C5f7e2bb453478f72fd00c9,
    // 0x6c7b8F499A3a0C310e4A1c9EdB8406E764590950,
    // 0xCf388621A1A0e2Bd57902A74edb2eEd05B7f0e15,
    // 0x60FEAdA91a87101761a08daEFACA05A7fDc88AE3,
    // 0xc984DE9667e5dc1783557244b72e2E6f1a096d29,
    // 0x0f22b846dA6DAeA9483F16a685264A1e9b4939B5,
    // 0xbAaCac6ecC90bEdA09199fB5D3E6Ee411F4E3A62,
    // 0xD2E0A7abe87880163B2b8235E94DE2cbc26aA8a9,
    // 0xA400Ea53A3c13e56AD1039C414008837fce0e61a,
    // 0x413c98D13c92ebeA6E1BD92cd6bd76090176F304,
    // 0x70Fb1249CdbFdE4Cd60c2eFf28a37920946cE325,
    // 0xC050cc9dB67E9ACf087a95bD3fcAB510F055f9E3,
    // 0xdB1db4C8fCf4dAd76F66e3061B984308e5F22789,
    // 0x997eEb18CFCE93dDec94062d13d565b966aC8249,
    // 0xAe0CFc332dAF84453452f4049700CFe708fe4624,
    // 0x61e91944Afbd67C79429935BEDBB762eBB04caD7,
    // 0xC603483c46980ae77AD662d3f0750E23444Ad223,
    // 0xCb15DcfdEe8a7a2BeC8561d33625B4FF7968baB4,
    // 0xE87FEd3a150FBcD6d77a3313ffDf6fE268baF289,
    // 0x1e7e4b0dDbf3406b9D3362D2901dc20D63814d84,
    // 0x82B97FE157c390fD334C1AaeBC767113CaFA2154,
    // 0xdEe517bFc5DB0122e56FfDD605286F87b81b83dE,
    // 0x7cFEd0B5DFef9b43CbAD7Ec77CAdA07B0B028917,
    // 0xcAd007f13D072BEff876e3773fd31a46A8a7705A,
    // 0x119030aD7E6FEa8f694782898038da2E768cF6BF,
    // 0xDb9bc9326324c4Cdf402b2546c2C8ca6EEA1377A,
    // 0x7BBeBf6FFa1b3ED6c4999a201840b808f17f8E40,
    // 0xF5fF310982D58Ddc813C541a64b8C4f3F5035E58,
    // 0xFa0a1973413C626439C36110f960c38620d5FC18,
    // 0x92f77dF1bDA3bD38430f05D17e8E6f0cf1b57e3B,
    // 0x36B95d4B0233Cb14A420E16A386c7150eAa1ab55,
    // 0x7Cb552152e2b28F9f6911c51B69B0d8D1FADafe1,
    // 0x124a48EEc409060A38C84dB00C5a51F897605f35,
    // 0x2130FD01026867A6c8DdE24ad5E64F2e2DFce196,
    // 0xCd6Dc668F7a57431F9b833Af11AdD9a73686c320,
    // 0xE3666187c7Fbd30ea514a00747f27BeF2Df27d69,
    // 0x40c119d71FEb072FD2ED4136Af6bf81f0F2c57e7,
    // 0x2Ea92Ed95e7e7EA0E9Cd7ad604A994865D49F1D4,
    // 0xBB00bAf5124474fc64305B1c14D65Db66E0Babb4,
    // 0xa20e77A9025E1469C30F530D9e55353782F86Fb5,
    // 0x4FfD0A59a26cB2Aa76D403215e4cC2845C053994,
    // 0xCF75fCf0f82C6B946a2A29E002C72F908BFecEd7,
    // 0x3aF849172D1e12c3D91e70197568B929c42FC1d7,
    // 0x09d66ecF9704eD2C5c8D3532223323c3253339eE,
    // 0xfc2efD858f3e9D401031bF8684A13f62826a43Ac,
    // 0x2bB1c3fE5feC2977f97dE819044467AF77117630,
    // 0xDEe6CFF449335e39D12236a5AfD069A27E589708,
    // 0x5a8d820F41f9b2D70cf079A5bAb0B19658DcA09D,
    // 0x9B3f96E737095fd5CA7235A0470F6B778072C323,
    // 0xfC89450C690A555A90B98505E2c2B128A99dDDf0,
    // 0x7fA6D3944fefCD7f567D960c2150e351825113EF,
    // 0xDfcFc1424B030E05C6961E283096486D505d7f20,
    // 0x2279122Cc80B30b77AcFcF07AE304Bfa8186c51F,
    // 0xDf016d49Bb059b6A1ec651Bbc04c54dE701f5C47,
    // 0x75D7c741Bb242632593a42B141Cf7B8A3c84ECC2,
    // 0x4596E8fA7DFb9740B4a69a33a28bc5c65f8Dcb00,
    // 0x689E994D0e4FcD7F5771DE774Bc83e4126e468F4,
    // 0x4697F17dc804f5916f3a41C6D522b489468E2B87,
    // 0x08Ec41FDcb5F9cD49a2a9d76bBEEf952A5d5739d,
    // 0xE229d80fdda6008ABb6aCc880556032c757F966d,
    // 0x1D7f204Ca9Fcc11733fe6F465EfaCA071c05D50a,
    // 0xA2c21c71a86Aa9ed0252cEC5e0b2070CC119E8ec,
    // 0xD9e4C45C4471F63420E434756C5026286D28fbdb,
    // 0x7F54285a9c022fC5F528045cbD63Bf9a7c51aFD8,
    // 0x4d1de98D67b3dfae5B6919dA25B0EA7fE9Ff1006,
    // 0x429a65e517088Db3e0fe60a629Def3F603d006A7,
    // 0x52b4af394C7DC271C9716084A46203ad8431e1B9,
    // 0x04B062a9047A22C1413c9b7f206cfb402372A40B,
    // 0x2bdBd48d8e17B457575b8aFEf99d38b117aac460,
    // 0xE89e8fe8936eb33e34E7A8277DD53788ADE79650,
    // 0x89A1fDb575933ac14B5cbF3E612e7F87b5872DBf,
    // 0xd14BF29e486DFC3836757b9B8CCFc95a5160A56D,
    // 0xB57B0713B72CB43a089dce420db9aAfAAa91be8d,
    // 0xb641F5EDe32Fcb0BF117EFb8EE68507aFe634Db3,
    // 0xD5564E42eb817535FeE0Eca8bA816bd23Bd44b5C,
    // 0x420D8DB9647262bb3312BE9eEe510D44E9689c3F,
    // 0x1d2A03031B1eDfa54f42081627bB9d48839eA636,
    // 0x381081364ce6F2D66D5a59E4AC5FC16C171f8503,
    // 0xB4a4c0add48618Dd3bf02e27c54833e3e0d17630,
    // 0x9Cd107096b516dE2fB901C0853C2D0E5d0a42e97,
    // 0x2C21DC4fe422fBAdd7DC1edA8AC4D10a8D9fFa2e,
    // 0x812DB8d92e1215729FABAD7108395a6A7AC9134A,
    // 0x7890fF0d468b169AcC30081e229dB4BEa65621dd,
    // 0xD2f8e30b6Ef8FaD692C3C1A11258c1bDc65Ae2EC,
    // 0x843C5A361F3Fb9aA52c88529633FD9DBaE69c91d,
    // 0x112513AEC425C87e0f94f28d2A5aa4Cb6d88A6a4,
    // 0xD92a7F3E6e8F7731f3DC6BE3FB39E745Ec1C6482,
    // 0xA839B3Fa0635aA63f2EAaafBE09F3caCf914fA42,
    // 0x0f934148bbC7A529a53a9E5d683AB9dDEc7116d9,
    // 0xC28B51b270d7F126fC6659A9C0f748AdB787A155,
    // 0x04E1aeC5FA92D2c8Fc5F4F584BC9e9471f45Ec93,
    // 0x63dbCfF5D4F831E8a48E249A72773f32b97eb99E,
    // 0x758dDab0f1D345b6d01333fD72946CA23bE3214C,
    // 0x264827B8DD1cA3EF6afB080241B3D3D8dE8178B3,
    // 0xb564AD33EDb3BD1b789C117E9c22624c0EfF1271,
    // 0xAF5FE2f18e681f81Ac73CEcE2BB18DaE3435aafc,
    // 0x923208A2A79D2EE5A0f65EA2BE7E1d0a05bEa55d,
    // 0xa12f0E781972Eda58c99beD6581f22a37D57E316,
    // 0x105d326450701879833E3CD33F161493f082902d,
    // 0xf7555E15FA0Eee406e7A960546caE5B9a99d953f,
    // 0x424A6d4BcfD3FE6C4d914920Da29bD4bc83E0f7E,
    // 0xA8518a2cCDfe353844F2fB553B90D8E8A740b347,
    // 0x0C3f8DE0761D67FC8F3343279AD1B4dFc4Ee10DE,
    // 0x541bC299778BAa8157a5bB093099791Ff05B0Cc4,
    // 0x558FbB1B9DDE11c85dA59dEe9b399Bf37016A999,
    // 0x00A104B51215180CD87071962567Cdff6961E0B7,
    // 0xfCC49e880B3A024d2A31742178d86CA5CfE0169D,
    // 0x1506A7142A35D151DeF426E55F476819586E47B6,
    // 0xC8a60f7fC1Ca1e2c1C13ee85eE1130024F69b07F,
    // 0x7b6AC5DF584f466Fa8670B1107638Dc7E940796f,
    // 0x682463b16fcB871a17d4Fb70A504FcA7E4414b83,
    // 0x595d12D50662D134dE871063F1a52aB6Ef227f43,
    // 0x25464e5765fFa8A2bfFB25B6347EaF3FF8F555dB,
    // 0xb9a50279173e65E7735d9e351bC32361a1236166,
    // 0x94F3bBb4533dfAe938E98F614bD574D6213dEb29,
    // 0x76cd684Cb4b6148F667e6eE7896e2f6FCB3caA7E,
    // 0x435b7D470767Cb121F37dD296B2AC7913fDF5427,
    // 0x19739686960105E8f2F34f7d6537Da651aD19157,
    // 0x4558347af80cC82862021B24F6AbF783Fc50C50c,
    // 0xC729d5A6eB0caaf27f4a68f31545Ee88c252A0A1,
    // 0x4040Ae6E1D67CC47060871ed9Dd7c3Eee7Ad5284,
    // 0x98Db5698Bd3BBC83812d2A8e03e1411b847310ac,
    // 0x73f13A414D820B5e9118713c7466985890D2bBE8,
    // 0x106829fC39b9e826f694686b0211D54C710e3dEa,
    // 0xB4D77E9a11425f8Bb6924B374385282Bf35a97D5,
    // 0xbcb23CAeDAAAE24AeFe4549e7058e25f3f714d9f,
    // 0x3E98d93877Cb0AA89C683b1C1851d5E01B26eD3D,
    // 0x6e0d01089976093680c881CcDcB79e0D046e2433,
    // 0x4f259E93603c6df312Aa04521350b3D354Aa6739,
    // 0x50598aF27B798d0b7F538B28e7C2f9994A9E58C1,
    // 0xD99a1d8a549fd6D5037A48516B4056FDD6AFfe97,
    // 0xD71d837b8ce264E9A24aCF9CdaEED32628acfcc0,
    // 0x49D8d8a61A7807a8cC78b42A34FA223014518863,
    // 0x903b473899b9868801f6b8b893Aef02a01445E7b,
    // 0x0A24d129a4CcF1f9874Dbea795a96d8d705e46DC,
    // 0xCA303f17e7B06Ff3333DC6fF90059b9A4893D00b,
    // 0xaBfC773D43FfFadE5ef01985E2625875cb144457,
    // 0xe328B5120378d93cF94c015fC6b6FDb4a2Ce6C95,
    // 0x1BdE4f98848CeBf240C524f2042C695d50002E7B,
    // 0x3403fe456E935e4c6387dbd434727223899E77C8,
    // 0x368c1f4D39DC929C0044B69d90FBcdd908B653EA,
    // 0x79cb30BbFE89ccaAF334540A6Be48fC0483fD944,
    // 0x35d3E27adA40f49AF6209c1F2405E136c8A80e35,
    // 0x127ef5a1A8eB8F3d7ba843eF7122327495C4b0C8,
    // 0x25Eb2A7Ed7c1AE23982B02097965680dC829e655,
    // 0x835fEd250287aba73698aa8a3214e276B0101C96,
    // 0xCa005f2b62C62ba46Cb52Cf795057254A877aAb9,
    // 0x2E4C9C2BB198A76Cb3d5a39991aF2B71716ff94a,
    // 0xC95bd0c4144DF206890C1641D675C3c2C55108c4,
    // 0x863429C69e45C66758F3052F3E4EEB6e0c39f58a,
    // 0x201a30Fb644eFEa1509DFe6143543EA26438F36b,
    // 0x3B01F07Ea49ec59F1Cbf74504870487C4E758EaC,
    // 0xF5FD85540d85A7D2b141B6481C7528BE686A7208,
    // 0x80c148b40502a3F7a6aec693FdC8a689a85D8A08,
    // 0x9b922e47BaD76614aa2E1D8D1FaF138d04d9d13c,
    // 0xEDdFD8e1F7Fb3E6FcB148DE877D761EA480d7536,
    // 0x0AC8184225156F8D11f73dCBdAF8cE5483DcDba7,
    // 0xf8ab4ddfF875885af5675CbD2D24B1AE327af58C,
    // 0x6C9258895FFBE2178b3EdEfE09AF304a1e99bF2F,
    // 0x9c535947C85754Fa686351feae36F480032EEE02,
    // 0x38eA9CB7aF6E9f0c59926e1aF750fF7699a7A451,
    // 0x160967Fa89B932F9757240E644abDaAcc60D35fD,
    // 0xf591D72e6d7657cA587315baC0dFb9130c1e5e7c,
    // 0xD8a52ba910f63bb2A09Ed5972465a04751d077a4,
    // 0xB3AB6804483ca39A5e0D5BA83661cE3C23c54622,
    // 0xcAd9474C90444eF3a7aD8658E20776Bc77585Ab7,
    // 0x2e7Aa1b4778E5AE4f9c090362Cc1fB6Ea6EBB2Aa,
    // 0xA8008579C617e81BbAd731b94E3282a28D155947,
    // 0xb689410B5e195d5935F3B703C30213C3F88debbA,
    // 0x7bd6A3e266f4Ca252D38e74fAB528F539765924c,
    // 0xEE152397aE5957d6637d105Bb71C4AA61B54Ac97,
    // 0x023d136B134A27d807c56A29b915C575770E5adb,
    // 0x42b5dea1282CD7408e9719526Ba4ad84296425D1,
    // 0x123270aE8ADf36e6A970490dAC53bc7ee856f52f,
    // 0x17795c5Bcc5843029b42bfe1b271c4b256625F83,
    // 0xB725cF24A34ACc0401954b4d090d8f6eA4c61151,
    // 0x2CC8724aD934A7bdB1Dd58211e96FfF8c9779B6c,
    // 0x85EaEc328DB27b20e29374bAbc16D82632DA32f0,
    // 0x745f98C08BbAa083E9C2504F014bcBFcF37AA641,
    // 0x50a4a5C94dd293cDA1704cE17Ef98a8a71CFfdcc,
    // 0xb8A90Afa005006ea760151eAf8e8C3B25d7f6ea9,
    // 0x9EF171A8C62Eea6455830Bde5de99Db5A7cA5119,
    // 0x3D6823f66026300599782f8881d6A936624b38CA,
    // 0x8b5Bbe26853B1367466B9Ef2bB1A500F0f3e0dCa,
    // 0x2EeB168080f16C6e0D45fC4eF824d89C7156668d,
    // 0xE429531F863076FC135CAc83e027827dC8AdFDAA,
    // 0x2f75fFe98046E4a55Fa79daf97B2730d7e707186,
    // 0xD108ad49061eD3eeDF12b4Ef882ffFf4D8Db65BA,
    // 0x7AA73FBd2FDB90D6Ca636B25CB63A339093C3F3C
    // ];

    address[] public lineaUsers = [
        0xF1D6ab29d12cF2bee25A195579F544BFcC3dD78f,
        0xEdeA7aAF2036686b01a5c1D1Fd09a86042BB4189,
        0x7D66a2e916d79c0988D41F1E50a1429074ec53a4,
        0xcd69567080Dccad1Afe61aCc022c0A7164B29AB4,
        0x119030aD7E6FEa8f694782898038da2E768cF6BF,
        0xaeD399a5625aE5b3B5E1a7cE725F62E0f369F4F8,
        0x510A269A93736B5B5E3C2133e8f2e7D829ca3Fec,
        0xDb9bc9326324c4Cdf402b2546c2C8ca6EEA1377A,
        0x7BBeBf6FFa1b3ED6c4999a201840b808f17f8E40,
        0xEc8676ECF9Acf53Bd0CBbcA0f95108730bc49c39,
        0xF5fF310982D58Ddc813C541a64b8C4f3F5035E58,
        0xFa0a1973413C626439C36110f960c38620d5FC18,
        0x7b65bE6FDA7107D3AB7959ee3c81BbEc7ea7e833,
        0x92f77dF1bDA3bD38430f05D17e8E6f0cf1b57e3B,
        0x58f1101f3632f1D0544197351FbdEd673f4b43F1,
        0x36B95d4B0233Cb14A420E16A386c7150eAa1ab55,
        0x7Cb552152e2b28F9f6911c51B69B0d8D1FADafe1,
        0x54d765404f9D4FF2bD6334a395Ef4CC042912c87,
        0x124a48EEc409060A38C84dB00C5a51F897605f35,
        0x2130FD01026867A6c8DdE24ad5E64F2e2DFce196,
        0xD95451B9F51bfE8f37BbF2165C4aA37F9BD7Cd28,
        0x1ac686c047283D7EF65345475A2633b6904ECa4d,
        0xCd6Dc668F7a57431F9b833Af11AdD9a73686c320,
        0xE3666187c7Fbd30ea514a00747f27BeF2Df27d69,
        0x40c119d71FEb072FD2ED4136Af6bf81f0F2c57e7,
        0x2Ea92Ed95e7e7EA0E9Cd7ad604A994865D49F1D4,
        0x78CB7537E0b9a6bDe79654ceF4a6A2F4A7f3B514,
        0xBB00bAf5124474fc64305B1c14D65Db66E0Babb4,
        0x9eDA9317771080eC5c5Da3b88b4D349103D18EEc,
        0x7841708EE45e96464bbd5Ec53f2f0b5671e720C2,
        0xa20e77A9025E1469C30F530D9e55353782F86Fb5,
        0x4FfD0A59a26cB2Aa76D403215e4cC2845C053994,
        0xCF75fCf0f82C6B946a2A29E002C72F908BFecEd7,
        0x3aF849172D1e12c3D91e70197568B929c42FC1d7,
        0x09d66ecF9704eD2C5c8D3532223323c3253339eE,
        0xfc2efD858f3e9D401031bF8684A13f62826a43Ac,
        0x2bB1c3fE5feC2977f97dE819044467AF77117630,
        0xDEe6CFF449335e39D12236a5AfD069A27E589708,
        0x5a8d820F41f9b2D70cf079A5bAb0B19658DcA09D,
        0x9B3f96E737095fd5CA7235A0470F6B778072C323,
        0xfC89450C690A555A90B98505E2c2B128A99dDDf0,
        0x67dc0cAd9F5a12a4e5FaA368A6Aa7CD7FB6259C2,
        0x7fA6D3944fefCD7f567D960c2150e351825113EF,
        0x505BDde1984E5b76F6455D533D0D116Af4d061bc,
        0xC3057B4F07e20CAaeF063075D05344C9a9E0452e,
        0xDfcFc1424B030E05C6961E283096486D505d7f20,
        0x124a48EEc409060A38C84dB00C5a51F897605f35,
        0x2279122Cc80B30b77AcFcF07AE304Bfa8186c51F,
        0xA7B729c880512A177c4B92Ab632E70988fb47462,
        0x529407C4e9584701253D93DDa4686a630Ada00e5,
        0x75D7c741Bb242632593a42B141Cf7B8A3c84ECC2,
        0x689E994D0e4FcD7F5771DE774Bc83e4126e468F4,
        0x4697F17dc804f5916f3a41C6D522b489468E2B87,
        0x08Ec41FDcb5F9cD49a2a9d76bBEEf952A5d5739d,
        0x1D7f204Ca9Fcc11733fe6F465EfaCA071c05D50a,
        0xA2c21c71a86Aa9ed0252cEC5e0b2070CC119E8ec,
        0xD9e4C45C4471F63420E434756C5026286D28fbdb,
        0x43B2D03C55418c7CAf4Bd137B115f0eeB15B6D4c,
        0x2130FD01026867A6c8DdE24ad5E64F2e2DFce196,
        0xF5fF310982D58Ddc813C541a64b8C4f3F5035E58,
        0x67dc0cAd9F5a12a4e5FaA368A6Aa7CD7FB6259C2,
        0x303F2d38AB911296DEcA9dC19968a854d9cBCAdC,
        0x49F63B254EA9043E57678C13E06Aef257fab45C1,
        0x1eC8F94b0ef0Dc6a9Ff923dfdf2523f4456CdFfD,
        0x9eDA9317771080eC5c5Da3b88b4D349103D18EEc,
        0xE165c34D3c5eCf7dF2aFF2955FE3A7Bd7CB38b4C,
        0x7455b2b0fA3E38051cc1744b7f4a49d34A7C824c,
        0x8f7746510b6CDB91AcE7F6749fAd2edA44Da1171,
        0x4A219402d71BF58114F1b699654aCF388E2dA672,
        0x25aFBD53E030f77309F2008e4214179533B67E11,
        0x553A7130D1b84651327865e0c623e21B9E97D447,
        0x655301eB3992fA35fF6fec91567240310a9756A6,
        0x2E11092aFafce07F68A2579b76139233b1ba6Caf,
        0x57F6F77da955C8FA89f3CF7973a1fB8054B56204,
        0xA4c63A2E8D0556dDB36C6544625284c663642387,
        0xE3bB042f9Cc751AFAF7C14FC0b2848FAE17CB08a,
        0x58f1101f3632f1D0544197351FbdEd673f4b43F1,
        0xdB2B9D473014d8c6A5E55dA92205199457Ba6624,
        0x1C1795bffeDa25De01A7C21c88b49D9592B0598D,
        0x607E73C236983D56Bdfc52753016932Bf0eAd90E
    ];

    address[] public rex33Users = [
        0x7D66a2e916d79c0988D41F1E50a1429074ec53a4,
        0x61cd1eB8434aaBDD38A0Abd62Dc8665e958E41d1,
        0x972698bF61E2377B5c45B3038D85d04981ddb48c,
        0x687baA6fC8ceD1e83e27CAA6334dB0D9acE61e7f,
        0xF1D6ab29d12cF2bee25A195579F544BFcC3dD78f,
        0x8A0E282923DF54FbAe68f0CA7b8C859eDbc2f11e,
        0xcd69567080Dccad1Afe61aCc022c0A7164B29AB4,
        0xF2Cf9d7513A2F6EAAe9d82b95B3c40D0efebE33B,
        0x97D37E8B619cF4C6145da456766CA4FA157292D3,
        0xa6fbe8f447fe74D39C2D904D521a2819C4BA7C33,
        0xaeD399a5625aE5b3B5E1a7cE725F62E0f369F4F8,
        0xae3Ee333196aa374FAdc99b330868d87Ae57b246,
        0x510A269A93736B5B5E3C2133e8f2e7D829ca3Fec,
        0x8a81DAFbFA575C9992eb649bA3F370197F7De9b9,
        0x472Bf5Ff7b96033BD203b360403A0649A908DBE4,
        0xd52929B69680A6f74D2eB9c8F1ef482f37b1b32B,
        0x55FA15d71Ef24a8aeD9F89a1fD19cB55B5737e49,
        0x7b65bE6FDA7107D3AB7959ee3c81BbEc7ea7e833,
        0x8f09e6f29ED099288E824BCa5BF34e4D3B40CDF4,
        0x88f9B5E019e959B3380c67AD94379eFAbE994825,
        0x2a377028DF028828dEbC0De6B0280AFeA007a7CE,
        0x95f3A8dc78929F065544fbD3caA0FA3Bd9CD3e7C,
        0x8699D8817356f3f55C25E5216322a82f1f7942D7,
        0x19Fa956048DF9A0024d4E65dAB6422f99eDb125F,
        0x013a1866c1C6E7BfD99178D5de49F2830b5Caf87,
        0x35fE83086417ac7EA4e9E80D1D3369C455c17005,
        0xCE29ECB0D2d8c8f0126ED923C50A35cFb0B613A8,
        0xC6CE31DaFf9175a30FCEf932180b0A783cEAdD06,
        0xEdeA7aAF2036686b01a5c1D1Fd09a86042BB4189,
        0x1ac686c047283D7EF65345475A2633b6904ECa4d,
        0x329CfE850FF4CF637aa2353ef2D3672156E54d6C,
        0x50D229b19Afe670EF4adF092d8a66Be0bE471039,
        0xD95451B9F51bfE8f37BbF2165C4aA37F9BD7Cd28,
        0xBeC88d61cd94Da3Ee08F844c536140C1D10095c5,
        0x54d765404f9D4FF2bD6334a395Ef4CC042912c87,
        0xDf0EF4d11Ac2a77D7155a83ED9653e1E10725C4e,
        0xa7AB43295A9bddE0d185049c45ED5FfA1758c190,
        0xbeb15caee71001d82F430E4deda80e16dDf438Db,
        0x8dF59E597266bd3FE4C817aC983D2B57dFa70131,
        0x7374E3e9C57b7063dF9216Fe46b179747e9Ae2c6,
        0xbfD9A3b20fFcb0F4ac06884DEE5DaE484915F5c9,
        0xc7F354b172e53c0dfFA8Db17b028F634CD2EFCBF,
        0x0D8A31bdce93d40978171f762C0247F108903b0D,
        0x78CB7537E0b9a6bDe79654ceF4a6A2F4A7f3B514,
        0xc091CC903828866E4D0087621d92F619107Afce2,
        0x56D7A1BB1405db9c4b9b06e2610d8b25d068F308,
        0xe0A86AFB73c0922A50D4A985A25507EcDA8a9B51,
        0xA72Cf13C434Ae89ca6ad0802e38074345dF0a882,
        0x9aA9BaAf1e4Cfea1560cC5dD19f4351b49E299F4,
        0x9eDA9317771080eC5c5Da3b88b4D349103D18EEc,
        0xC20C94022182505A0c73D1F235Acb86647Bda29E,
        0xFb9Cbb2FEDEc281B80AeF79Cc1f39d547EFB956e,
        0x8c9Dffe11BbE2cE25b12Af35C9ff425492fbC9A2,
        0x4dAf8ce9D729ca4F121381ec4B22123627C1C004,
        0x098fFf7E82dAd4488f94d7Dbe1415dd913066355,
        0xcaFa3E48Ad50120358072Befe591e00c7118d1B9,
        0xC55720f140337755346ca0bCCB5ab3e2E07D27c3,
        0xcF89b2628925F9c97cB2C2bB47dd59e060C50f62,
        0x21bC7fBf89B07E318dcE55676BfF0c3FF5EDB948,
        0x391542D068952fdbE793fCA253A948329F2880c7,
        0x0A83985E4A6E8Dae2B67beD4f2d9268f6806Ce00,
        0xb794A8aa430907390B13C24932fe5C982B894DAA,
        0xDD0c16db6ED4f670BB4dC7235ab6b7C100773b88,
        0x72727d612CD162c30f84B579662a9bDe34481aE7,
        0x4fd1Cb0c9661E1886734e7ab9C0197A37cb1A02C,
        0x0CeCc8F202CDd0bA7efA81F5f9518927D31B36d1,
        0x82F9C16D5ADA0C406aA432b4B79A15F6F7725Ae5,
        0xc8B19839ae371bd541F20B15c3A3CB82BFB6A6C6,
        0xC8CaEc7aE8B36676c5C60D11423C6dAC8343EB19,
        0x505BDde1984E5b76F6455D533D0D116Af4d061bc,
        0xA84fE466486223FA9BbA2dD3ecFb5C1100311711,
        0x9fD6b6ccad34803fdf62DdDb3f23BFC5ec4c2f04,
        0x908Fd947485FA2501273c81CB4b639eE17045468,
        0xCf571e890c3F319978EDA4Fe9f62dBe9cc7E3Aa0,
        0xb79185Aa49426D57fF9e9F96c276E559549AA732,
        0xDD0CDF8D98d9Ad3ADfaa49AaECD444Bfa01d9C9a,
        0xB3bfB32977cFd6200AB9537E3703e501d8381c9B,
        0x7BFEe91193d9Df2Ac0bFe90191D40F23c773C060,
        0xABa29a215Ae420ddfa73929fcD958e5d3ba11D17,
        0xAC1c487f78564dfFB2c94D6f28EdF04E18843004,
        0xeb7846Ad58FBDaC651830d5370a94488c06F282d,
        0x40D0759C8e8330f46c0548743FA239A9d9190Fee,
        0xfae5Ba0a469179C88366EC33202e7bF24C649b01,
        0x001A794b0973AA5384ae9B7140A767782c038af8,
        0xAe5905De19D8E65b45D8179F71C72AF8018721CD,
        0x789498eE77215b80d201A814228fA7f248c3be18,
        0xb11903Ec9E1036F1a3FaFe5815E84D8c1f62e254,
        0x031F72dEB03C509af42624ddcD1f63fce5eCb220,
        0x1eC8F94b0ef0Dc6a9Ff923dfdf2523f4456CdFfD,
        0xc9C384a9E7e28f7Ef55903eb90947fe3ce71D475,
        0xE165c34D3c5eCf7dF2aFF2955FE3A7Bd7CB38b4C,
        0x7455b2b0fA3E38051cc1744b7f4a49d34A7C824c,
        0x8f7746510b6CDB91AcE7F6749fAd2edA44Da1171,
        0x4A219402d71BF58114F1b699654aCF388E2dA672,
        0x25aFBD53E030f77309F2008e4214179533B67E11,
        0x553A7130D1b84651327865e0c623e21B9E97D447,
        0x655301eB3992fA35fF6fec91567240310a9756A6,
        0x2E11092aFafce07F68A2579b76139233b1ba6Caf,
        0x57F6F77da955C8FA89f3CF7973a1fB8054B56204,
        0xA4c63A2E8D0556dDB36C6544625284c663642387,
        0x1014A66402Ff5b51d86a527da1dbe96343Bd9D95,
        0x126FF8faBeC84EF8a96F25dD0C2668fB9b7E7088,
        0x026F34De8aD8Ac421f85C7Cbb3d13f04529aA7b8,
        0xaF0114811527B29E07B374EcA3114dBE20992c79,
        0xf2Bc825FB466136d00571B496E6EB1a601679919,
        0x49F63B254EA9043E57678C13E06Aef257fab45C1,
        0x47CF3216065840b831c343bB3445d753204cdBBb,
        0xA7B729c880512A177c4B92Ab632E70988fb47462,
        0x57354e7567331d2974De08aC283d7f5663eCCa93,
        0x598Eec18F8412e326e1Caa73d91cAEAD065651e1,
        0xE3bB042f9Cc751AFAF7C14FC0b2848FAE17CB08a,
        0x58f1101f3632f1D0544197351FbdEd673f4b43F1,
        0xdB2B9D473014d8c6A5E55dA92205199457Ba6624,
        0x1C1795bffeDa25De01A7C21c88b49D9592B0598D,
        0x6270df891fC56b3f4D75361185A31194b29AFD5D,
        0x9C9553CD0c8673651A36e5E11C4989bb629D4067,
        0x9e3aE00085e9f5c302bEfEC347d6a0560DE72C6E,
        0xDEAdF06F9Cd85CBc94Ffd9af05db9C24e32B7820,
        0x5d6BB3519cc1f484aAe443D4b0650F0af8a3c0E6,
        0xC9EEF46E1AB9C4eEdC7B7cBd36Dc37C1A0EB1f75,
        0xa056C95d109E69667f23B0bd4c5b94A58CBB412a,
        0x6649449f075A8F6Aa56Efe43ab5c45B8ca0dFe2C,
        0xE451DC0948F33B1261c585f0DB84cca9Ab69F3A4,
        0x1B5db5c065d7507DBF65032a1835e4a7B633E67b,
        0xC2Fa91EFdE9fd71b3AC5912f7c7A48D4680847ec,
        0x4316c8275A46878837a0AaE31E5741E6C0665d72,
        0x80ff9275306dCe02b9779F1b9336112CBf850fcb,
        0x21914aB1b8c3ABc79f6312148b3506DA965D396b,
        0xC0E88f859dE5c9EBDDDd7e5C4c46ab7fcECd65d7,
        0x607E73C236983D56Bdfc52753016932Bf0eAd90E,
        0x4071484638157875C8E2D74b066135Dd9b12e25b,
        0x3C4524481a34551fc5Aa239250F07A986Ed2c2E1,
        0x3Da8cADa0F3801D13eb0748ab4f5f6eE0F450690,
        0xd6f8f76EF075e9B585a847B730C0531C1354671A,
        0x303F2d38AB911296DEcA9dC19968a854d9cBCAdC,
        0x477dE3668C728adb0045f0BBe06eE9d0230c1564,
        0x7841708EE45e96464bbd5Ec53f2f0b5671e720C2,
        0xBf4295753a763615B87024f9Dc234Df2748c512A,
        0x4C92Ab257222BCd47E299aDdF268D696Bb3B00d7,
        0x8dF3e4806A3320D2642b1F2835ADDA1A40719c4E,
        0x9BBCa2632Dfcaa1962b18275086338fc8AC47DA2,
        0x68f861D975594e3a36281bfb5E5e6A9BE67C3359,
        0x49a5492FDFe5AcC966dD5f41310dfDfe8dAA349C,
        0xF514E198143Ed375aD99c224059a3BC301766adB,
        0x81B74321c33538e54F1690add3f874f68Dab5921,
        0xBa731Fd3431dE103f16e6D9B0cC62ff74107ff41,
        0x02dCFB1d14bB6D36b9126eDe6A8CCb3c5940326E,
        0x43B2D03C55418c7CAf4Bd137B115f0eeB15B6D4c,
        0x17748cB3aa5528C4eaC514f8b6E8FAdef13B29b4,
        0x1E4083200704948eEC75feD99422BB718e1A269C,
        0x3b6239114d84A25D4CE995B344d399DD0a0ed4f6,
        0x6aa0ae3b73b30DcA351fC640380e87EcEA6bE499,
        0x5CB97ec856d779cF7b130408D18CC802824ccf5F,
        0x6e4aeB2Af9CE3b67116d8B19E6f1CA6b318Fc629,
        0x8011d0c9DB37CBCF7cA781918B4AD0cB50A177D4,
        0x4c7eabe657187D2c8C5f7e2bb453478f72fd00c9,
        0x6c7b8F499A3a0C310e4A1c9EdB8406E764590950,
        0xCf388621A1A0e2Bd57902A74edb2eEd05B7f0e15,
        0x60FEAdA91a87101761a08daEFACA05A7fDc88AE3,
        0xc984DE9667e5dc1783557244b72e2E6f1a096d29,
        0x0f22b846dA6DAeA9483F16a685264A1e9b4939B5,
        0xbAaCac6ecC90bEdA09199fB5D3E6Ee411F4E3A62,
        0xD2E0A7abe87880163B2b8235E94DE2cbc26aA8a9,
        0xA400Ea53A3c13e56AD1039C414008837fce0e61a,
        0x413c98D13c92ebeA6E1BD92cd6bd76090176F304,
        0x70Fb1249CdbFdE4Cd60c2eFf28a37920946cE325,
        0xC050cc9dB67E9ACf087a95bD3fcAB510F055f9E3,
        0xdB1db4C8fCf4dAd76F66e3061B984308e5F22789,
        0x997eEb18CFCE93dDec94062d13d565b966aC8249,
        0xAe0CFc332dAF84453452f4049700CFe708fe4624,
        0x61e91944Afbd67C79429935BEDBB762eBB04caD7,
        0xC603483c46980ae77AD662d3f0750E23444Ad223,
        0xCb15DcfdEe8a7a2BeC8561d33625B4FF7968baB4
    ];

    address[] private lstUsers = [
        0xbeb15caee71001d82F430E4deda80e16dDf438Db,
        0x97D37E8B619cF4C6145da456766CA4FA157292D3,
        0xF1D6ab29d12cF2bee25A195579F544BFcC3dD78f,
        0x7D66a2e916d79c0988D41F1E50a1429074ec53a4,
        0xcd69567080Dccad1Afe61aCc022c0A7164B29AB4,
        0x61cd1eB8434aaBDD38A0Abd62Dc8665e958E41d1,
        0xEdeA7aAF2036686b01a5c1D1Fd09a86042BB4189,
        0x7b65bE6FDA7107D3AB7959ee3c81BbEc7ea7e833,
        0xFFbA0Ce4b97EaE5f865B84B55ec1094dA5245039,
        0x510A269A93736B5B5E3C2133e8f2e7D829ca3Fec,
        0x19Fa956048DF9A0024d4E65dAB6422f99eDb125F,
        0x1ac686c047283D7EF65345475A2633b6904ECa4d,
        0x8c9Dffe11BbE2cE25b12Af35C9ff425492fbC9A2,
        0xFb9Cbb2FEDEc281B80AeF79Cc1f39d547EFB956e,
        0x5EeDe1C45E4401d7D95E55446dAd71B511328534,
        0x391542D068952fdbE793fCA253A948329F2880c7,
        0x11315Cce8f009e4CB4234FFEAF2E860b84E5b0f6,
        0x14b35EA598a18e171a8f1e724c356F83fB4A0F18,
        0x360c0eABAA89eb98Bb1Fc741bC4B3198D167A883,
        0x67dc0cAd9F5a12a4e5FaA368A6Aa7CD7FB6259C2,
        0x8B4441E79151e3fC5264733A3C5da4fF8EAc16c1,
        0xF2Cf9d7513A2F6EAAe9d82b95B3c40D0efebE33B,
        0x529407C4e9584701253D93DDa4686a630Ada00e5,
        0x8a81DAFbFA575C9992eb649bA3F370197F7De9b9,
        0xEc8676ECF9Acf53Bd0CBbcA0f95108730bc49c39,
        0x1014A66402Ff5b51d86a527da1dbe96343Bd9D95,
        0xc8B19839ae371bd541F20B15c3A3CB82BFB6A6C6,
        0x0f14588c202d216EE5731de905390516F5714E95,
        0x0CeCc8F202CDd0bA7efA81F5f9518927D31B36d1,
        0xC3057B4F07e20CAaeF063075D05344C9a9E0452e
    ];

    address[] private asteraUsers = [
        0x1ac686c047283D7EF65345475A2633b6904ECa4d,
        0xbeb15caee71001d82F430E4deda80e16dDf438Db,
        0xd52929B69680A6f74D2eB9c8F1ef482f37b1b32B,
        0xF1D6ab29d12cF2bee25A195579F544BFcC3dD78f
    ];

    mapping(address => uint256[]) miniPoolToBalances;
    Liquidator liquidator;

    function setUp() public {
        // LINEA setup
        string memory lineaRpc = vm.envString("LINEA_RPC_URL");
        uint256 lineaFork = vm.createSelectFork(lineaRpc);
        assertEq(vm.activeFork(), lineaFork);
        liquidator = new Liquidator();
    }

    function testBalancesBeforeAndAfterHack() public {
        string memory lineaRpc = vm.envString("LINEA_RPC_URL");
        uint256 lineaFork = vm.createSelectFork(lineaRpc, 24320158);
        assertEq(vm.activeFork(), lineaFork);

        uint256 initialAsUsdcBalance = IERC20Detailed(USDC).balanceOf(ASUSDC);
        uint256 initialAsWethBalance = IERC20Detailed(WETH).balanceOf(ASWETH);
        uint256 initialAsWbtcBalance = IERC20Detailed(WBTC).balanceOf(ASWBTC);
        uint256 initialAsUsdtBalance = IERC20Detailed(USDT).balanceOf(ASUSDT);
        uint256 initialAsAsUsdBalance = IERC20Detailed(ASUSD).balanceOf(ASASUSD);
        uint256 initialAsmUsdBalance = IERC20Detailed(MUSD).balanceOf(ASMUSD);

        console2.log("--------------------BEFORE-------------------------");

        console2.log("initialAsWbtcBalance: ", initialAsWbtcBalance);
        console2.log("initialAsWethBalance: ", initialAsWethBalance);
        console2.log("initialAsUsdcBalance: ", initialAsUsdcBalance);
        console2.log("initialAsUsdtBalance: ", initialAsUsdtBalance);
        console2.log("initialAsAsUsdBalance: ", initialAsAsUsdBalance);
        console2.log("initialAsmUsdBalance: ", initialAsmUsdBalance);

        for (uint256 i = 0; i < 4; i++) {
            address erc6909 =
                (IMiniPoolAddressesProvider(MINI_POOL_ADDRESS_PROVIDER).getMiniPoolToAERC6909(i));
            IMiniPool miniPool =
                IMiniPool(IMiniPoolAddressesProvider(MINI_POOL_ADDRESS_PROVIDER).getMiniPool(i));
            (address[] memory reserves,) = miniPool.getReservesList();
            miniPoolToBalances[erc6909] = new uint256[](reserves.length);
            for (uint256 idx = 0; idx < reserves.length; idx++) {
                miniPoolToBalances[erc6909][idx] = IERC20Detailed(reserves[idx]).balanceOf(erc6909);
                console2.log(
                    "Initial balance for %s in MiniPool %s: %s",
                    IERC20Detailed(reserves[idx]).symbol(),
                    i,
                    IERC20Detailed(reserves[idx]).balanceOf(erc6909)
                );
            }
        }

        console2.log("--------------------AFTER-------------------------");
        lineaFork = vm.createSelectFork(lineaRpc, 24322904);

        assertEq(vm.activeFork(), lineaFork);
        console2.log("finalAsWbtcBalance: ", IERC20Detailed(WBTC).balanceOf(ASWBTC));
        console2.log("finalAsWethBalance: ", IERC20Detailed(WETH).balanceOf(ASWETH));
        console2.log("finalAsUsdcBalance: ", IERC20Detailed(USDC).balanceOf(ASUSDC));
        console2.log("finalAsUsdtBalance: ", IERC20Detailed(USDT).balanceOf(ASUSDT));
        console2.log("finalAsAsUsdBalance: ", IERC20Detailed(ASUSD).balanceOf(ASASUSD));
        console2.log("finalAsmUsdBalance: ", IERC20Detailed(MUSD).balanceOf(ASMUSD));

        console2.log(
            "Diff finalAsWbtcBalance: ",
            int256(initialAsWbtcBalance) - int256(IERC20Detailed(WBTC).balanceOf(ASWBTC))
        );
        console2.log(
            "Diff finalAsWethBalance: ",
            int256(initialAsWethBalance) - int256(IERC20Detailed(WETH).balanceOf(ASWETH))
        );
        console2.log(
            "Diff finalAsUsdcBalance: ",
            int256(initialAsUsdcBalance) - int256(IERC20Detailed(USDC).balanceOf(ASUSDC))
        );
        console2.log(
            "Diff finalAsUsdtBalance: ",
            int256(initialAsUsdtBalance) - int256(IERC20Detailed(USDT).balanceOf(ASUSDT))
        );
        console2.log(
            "Diff finalAsAsUsdBalance: ",
            int256(initialAsAsUsdBalance) - int256(IERC20Detailed(ASUSD).balanceOf(ASASUSD))
        );
        console2.log(
            "Diff finalAsmUsdBalance: ",
            int256(initialAsmUsdBalance) - int256(IERC20Detailed(MUSD).balanceOf(ASMUSD))
        );

        for (uint256 i = 0; i < 4; i++) {
            address erc6909 =
                (IMiniPoolAddressesProvider(MINI_POOL_ADDRESS_PROVIDER).getMiniPoolToAERC6909(i));
            IMiniPool miniPool =
                IMiniPool(IMiniPoolAddressesProvider(MINI_POOL_ADDRESS_PROVIDER).getMiniPool(i));
            (address[] memory reserves,) = miniPool.getReservesList();
            for (uint256 idx = 0; idx < reserves.length; idx++) {
                console2.log(
                    "Final balance for %s in MiniPool %s: %s",
                    IERC20Detailed(reserves[idx]).symbol(),
                    i,
                    IERC20Detailed(reserves[idx]).balanceOf(erc6909)
                );
                // console2.log(
                //     "Diff balance for %s in MiniPool %s: ",
                //     IERC20Detailed(reserves[idx]).symbol(),
                //     i
                // );
                // console2.log(
                //     int256(miniPoolToBalances[erc6909][idx])
                //         - int256(IERC20Detailed(reserves[idx]).balanceOf(erc6909))
                // );
            }
        }
    }

    function testMiniPoolParamsBeforeAttack() public {
        address token = 0xacA92E438df0B2401fF60dA7E4337B687a2435DA;
        address miniPool = 0x0baFB30B72925e6d53F4d0A089bE1CeFbB5e3401;
        string memory lineaRpc = vm.envString("LINEA_RPC_URL");
        uint256 lineaFork = vm.createSelectFork(lineaRpc, 24096677); //24096677, 24320598
        assertEq(vm.activeFork(), lineaFork);
        console2.log("---------------------------- BEFORE: --------------------------------------");
        AggregatedMiniPoolReservesData memory data =
            AsteraDataProvider2(DATA_PROVIDER).getReserveDataForAssetAtMiniPool(token, miniPool);
        logAggregatedMiniPoolReservesData(data);
        lineaFork = vm.createSelectFork(lineaRpc);
        assertEq(vm.activeFork(), lineaFork);
        console2.log("------------------ AFTER: -------------------------");
        data = AsteraDataProvider2(DATA_PROVIDER).getReserveDataForAssetAtMiniPool(token, miniPool);
        logAggregatedMiniPoolReservesData(data);
    }

    function testRepayLeftovers() public {
        vm.startPrank(IMiniPoolAddressesProvider(MINI_POOL_ADDRESS_PROVIDER).getMainPoolAdmin());
        // IMiniPoolConfigurator(MINI_POOL_CONFIGURATOR).setMinDebtThreshold(
        //     0, IMiniPool(0xE7a2c97601076065C3178BDbb22C61933f850B03)
        // );
        // IMiniPoolConfigurator(MINI_POOL_CONFIGURATOR).setMinDebtThreshold(
        //     0, IMiniPool(0x0baFB30B72925e6d53F4d0A089bE1CeFbB5e3401)
        // );
        // IMiniPoolConfigurator(MINI_POOL_CONFIGURATOR).setMinDebtThreshold(
        //     0, IMiniPool(0x65559abECD1227Cc1779F500453Da1f9fcADd928)
        // );
        // IMiniPoolConfigurator(MINI_POOL_CONFIGURATOR).setMinDebtThreshold(
        //     0, IMiniPool(0x52280eA8979d52033E14df086F4dF555a258bEb4)
        // );
        vm.stopPrank();

        deal(WBTC, 0xF1D6ab29d12cF2bee25A195579F544BFcC3dD78f, 1 ether);
        deal(MUSD, 0xF1D6ab29d12cF2bee25A195579F544BFcC3dD78f, 1 ether);

        vm.startPrank(0xF1D6ab29d12cF2bee25A195579F544BFcC3dD78f);
        // IERC20Detailed(WBTC).approve(
        //     0xE7a2c97601076065C3178BDbb22C61933f850B03,
        //     IERC20Detailed(WBTC).balanceOf(0xF1D6ab29d12cF2bee25A195579F544BFcC3dD78f)
        // );
        // console2.log(
        //     "Repaying debt: ",
        //     IAERC6909(0x24d61C71855d62d8C7630e5E91E1EF8482E32aE0).balanceOf(
        //         0xF1D6ab29d12cF2bee25A195579F544BFcC3dD78f, 2000
        //     )
        // );
        // IMiniPool(0xE7a2c97601076065C3178BDbb22C61933f850B03).repay(
        //     wasWBTC,
        //     true,
        //     IAERC6909(0x24d61C71855d62d8C7630e5E91E1EF8482E32aE0).balanceOf(
        //         0xF1D6ab29d12cF2bee25A195579F544BFcC3dD78f, 2000
        //     ),
        //     0xF1D6ab29d12cF2bee25A195579F544BFcC3dD78f
        // );

        // IERC20Detailed(WBTC).approve(
        //     0x0baFB30B72925e6d53F4d0A089bE1CeFbB5e3401,
        //     IERC20Detailed(WBTC).balanceOf(0xF1D6ab29d12cF2bee25A195579F544BFcC3dD78f)
        // );
        // console2.log(
        //     "Repaying debt: ",
        //     IAERC6909(0x5Fb9EBDD9bcBa3FB615CD07981aa5F4650BbD90D).balanceOf(
        //         0xF1D6ab29d12cF2bee25A195579F544BFcC3dD78f, 2000
        //     )
        // );
        // IMiniPool(0x0baFB30B72925e6d53F4d0A089bE1CeFbB5e3401).repay(
        //     wasWBTC,
        //     true,
        //     IAERC6909(0x5Fb9EBDD9bcBa3FB615CD07981aa5F4650BbD90D).balanceOf(
        //         0xF1D6ab29d12cF2bee25A195579F544BFcC3dD78f, 2000
        //     ),
        //     0xF1D6ab29d12cF2bee25A195579F544BFcC3dD78f
        // );

        IERC20Detailed(MUSD)
            .approve(
                0x52280eA8979d52033E14df086F4dF555a258bEb4,
                IERC20Detailed(MUSD).balanceOf(0xF1D6ab29d12cF2bee25A195579F544BFcC3dD78f)
            );
        console2.log(
            "Repaying debt: ",
            IAERC6909(0xc596AeF495cC08ac642A616919A8ee6213f533bb)
                .balanceOf(0xF1D6ab29d12cF2bee25A195579F544BFcC3dD78f, 2129)
        );
        IMiniPool(0x52280eA8979d52033E14df086F4dF555a258bEb4)
            .repay(
                MUSD,
                true,
                IAERC6909(0xc596AeF495cC08ac642A616919A8ee6213f533bb)
                    .balanceOf(0xF1D6ab29d12cF2bee25A195579F544BFcC3dD78f, 2129),
                0xF1D6ab29d12cF2bee25A195579F544BFcC3dD78f
            );
        vm.stopPrank();
    }

    function logAggregatedMiniPoolReservesData(AggregatedMiniPoolReservesData memory d)
        internal
        view
    {
        console2.log("underlyingAsset:", d.underlyingAsset);
        console2.log("name:", d.name);
        console2.log("symbol:", d.symbol);
        console2.log("aTokenId:", d.aTokenId);
        console2.log("debtTokenId:", d.debtTokenId);
        console2.log("isTranche:", d.isTranche);
        console2.log("aTokenNonRebasingAddress:", d.aTokenNonRebasingAddress);
        console2.log("decimals:", d.decimals);
        console2.log("baseLTVasCollateral:", d.baseLTVasCollateral);
        console2.log("reserveLiquidationThreshold:", d.reserveLiquidationThreshold);
        console2.log("reserveLiquidationBonus:", d.reserveLiquidationBonus);
        console2.log("asteraReserveFactor:", d.asteraReserveFactor);
        console2.log("miniPoolOwnerReserveFactor:", d.miniPoolOwnerReserveFactor);
        console2.log("depositCap:", d.depositCap);
        console2.log("usageAsCollateralEnabled:", d.usageAsCollateralEnabled);
        console2.log("borrowingEnabled:", d.borrowingEnabled);
        console2.log("flashloanEnabled:", d.flashloanEnabled);
        console2.log("isActive:", d.isActive);
        console2.log("isFrozen:", d.isFrozen);
        console2.log("liquidityIndex:", d.liquidityIndex);
        console2.log("variableBorrowIndex:", d.variableBorrowIndex);
        console2.log("liquidityRate:", d.liquidityRate);
        console2.log("variableBorrowRate:", d.variableBorrowRate);
        console2.log("lastUpdateTimestamp:", d.lastUpdateTimestamp);
        console2.log("interestRateStrategyAddress:", d.interestRateStrategyAddress);
        console2.log("availableLiquidity:", d.availableLiquidity);
        console2.log("totalScaledVariableDebt:", d.totalScaledVariableDebt);
        console2.log("priceInMarketReferenceCurrency:", d.priceInMarketReferenceCurrency);
        console2.log("optimalUtilizationRate:", d.optimalUtilizationRate);
        console2.log("kp:", d.kp);
        console2.log("ki:", d.ki);
        console2.log("lastPiReserveRateStrategyUpdate:", d.lastPiReserveRateStrategyUpdate);
        console2.log("errI:", d.errI);
        console2.log("minControllerError:", d.minControllerError);
        console2.log("maxErrIAmp:", d.maxErrIAmp);
        console2.log("baseVariableBorrowRate:", d.baseVariableBorrowRate);
        console2.log("variableRateSlope1:", d.variableRateSlope1);
        console2.log("variableRateSlope2:", d.variableRateSlope2);
        console2.log("maxVariableBorrowRate:", d.maxVariableBorrowRate);
        console2.log("availableFlow:", d.availableFlow);
        console2.log("flowLimit:", d.flowLimit);
        console2.log("currentFlow:", d.currentFlow);
    }

    function analyzeUsers(address[] memory users, address miniPool) internal {
        uint256 numberOfUsersWithBadDebt = 0;
        uint256 numberOfUsersWithLiquidityGreaterThan5Cent = 0;
        uint256 badDebt = 0;
        uint256 badDebtExcludingHacker = 0;

        console2.log("========== USER's SNAPSHOT ==========");

        for (uint256 idx = 0; idx < users.length; idx++) {
            Liquidator.UsdCollateralAndDebt memory usdCollateralAndDebt =
                liquidator.calculateUserCollateraAndDebtInUsd(users[idx], miniPool);

            if (usdCollateralAndDebt.userUsdCollateral > 0.05e8) {
                numberOfUsersWithLiquidityGreaterThan5Cent++;

                bool isHacker = users[idx] == 0xcd69567080Dccad1Afe61aCc022c0A7164B29AB4
                    || users[idx] == 0x9520C9040338bE61005590cC1BD15caa10a6613c
                    || users[idx] == 0x1D0A98B5daB763FaC9dd4d3d0FE7ada18DBb3535
                    || users[idx] == 0x510A269A93736B5B5E3C2133e8f2e7D829ca3Fec
                    || users[idx] == 0xA27eBF925Ec2D1db0cB6b5CAbDab108F71fa6b53
                    || users[idx] == 0x08ef8C80eBcFCb6a3D1460657c55042cEd5F45D3
                    || users[idx] == 0x76F844359ffBe267F4c02ffD76184e27b1AeBE6B
                    || users[idx] == 0x9B3020F0cABc4bA0346cce5FC02e7Cf681E0e227
                    || users[idx] == 0x9c57F65aB8c45E52128ea6630615f54E3038a4bd;

                if (isHacker) {
                    console2.log("\n[HACKER] %s", users[idx]);
                } else {
                    console2.log("\n[USER] %s", users[idx]);
                }
                console2.log("  - USD Collateral: %8e", usdCollateralAndDebt.userUsdCollateral);
                console2.log("  - USD Debt:      %8e", usdCollateralAndDebt.userUsdDebt);

                console2.log("    BORROWED TOKENS:");
                for (uint256 i = 0; i < usdCollateralAndDebt.debtTokens.length; i++) {
                    if (usdCollateralAndDebt.debtTokens[i] != address(0)) {
                        console2.log(
                            "      - %s: %8e",
                            IERC20Detailed(usdCollateralAndDebt.debtTokens[i]).symbol(),
                            (usdCollateralAndDebt.debtAmount[i] * 1e8) / 10
                                ** IERC20Detailed(usdCollateralAndDebt.debtTokens[i]).decimals()
                        );
                        if (!isHacker) {
                            debtAssetSum[
                                usdCollateralAndDebt.debtTokens[i]
                            ] += usdCollateralAndDebt.debtAmount[i];
                        }
                    }
                }
                console2.log("    PROVIDED TOKENS:");
                for (uint256 i = 0; i < usdCollateralAndDebt.collateralTokens.length; i++) {
                    if (usdCollateralAndDebt.collateralTokens[i] != address(0)) {
                        console2.log(
                            "      - %s: %8e",
                            IERC20Detailed(usdCollateralAndDebt.collateralTokens[i]).symbol(),
                            (usdCollateralAndDebt.collateralAmount[i] * 1e8) / 10
                                ** IERC20Detailed(usdCollateralAndDebt.collateralTokens[i])
                                    .decimals()
                        );
                        if (!isHacker) {
                            collateralAssetSum[
                                usdCollateralAndDebt.collateralTokens[i]
                            ] += usdCollateralAndDebt.collateralAmount[i];
                        }
                    }
                }
            }
        }
        console2.log(
            "Number of users with liquidity greater than 5 cents: ",
            numberOfUsersWithLiquidityGreaterThan5Cent
        );
        console2.log("---------------------------------------");
    }

    function analyzeBadDebt(address[] memory users, address miniPool) internal {
        uint256 numberOfUsersWithBadDebt = 0;
        uint256 numberOfUsersWithLiquidityGreaterThan50Cents = 0;
        uint256 badDebt = 0;
        uint256 badDebtExcludingHacker = 0;
        for (uint256 idx = 0; idx < users.length; idx++) {
            Liquidator.UsdCollateralAndDebt memory usdCollateralAndDebt =
                liquidator.calculateUserCollateraAndDebtInUsd(users[idx], miniPool);

            if (usdCollateralAndDebt.userUsdCollateral > 0.5e8) {
                numberOfUsersWithLiquidityGreaterThan50Cents++;
                if (
                    users[idx] != 0xcd69567080Dccad1Afe61aCc022c0A7164B29AB4
                        && users[idx] != 0x9520C9040338bE61005590cC1BD15caa10a6613c
                        && users[idx] != 0x1D0A98B5daB763FaC9dd4d3d0FE7ada18DBb3535
                        && users[idx] != 0x510A269A93736B5B5E3C2133e8f2e7D829ca3Fec
                        && users[idx] != 0xA27eBF925Ec2D1db0cB6b5CAbDab108F71fa6b53
                        && users[idx] != 0x08ef8C80eBcFCb6a3D1460657c55042cEd5F45D3
                        && users[idx] != 0x76F844359ffBe267F4c02ffD76184e27b1AeBE6B
                        && users[idx] != 0x9B3020F0cABc4bA0346cce5FC02e7Cf681E0e227
                        && users[idx] != 0x9c57F65aB8c45E52128ea6630615f54E3038a4bd
                ) {
                    console2.log("User: ", users[idx]);
                } else {
                    console2.log("->>> HACKER: ", users[idx]);
                }
                console2.log("  USD Collateral: %8e", usdCollateralAndDebt.userUsdCollateral);
                console2.log("  USD Debt: %8e", usdCollateralAndDebt.userUsdDebt);

                if (usdCollateralAndDebt.userUsdDebt > usdCollateralAndDebt.userUsdCollateral) {
                    numberOfUsersWithBadDebt++;
                    if (
                        (usdCollateralAndDebt.userUsdDebt - usdCollateralAndDebt.userUsdCollateral)
                            > 10_000e8
                    ) {
                        console2.log(
                            " >$10_000 Bad Debt: %8e",
                            (usdCollateralAndDebt.userUsdDebt
                                    - usdCollateralAndDebt.userUsdCollateral)
                        );
                    } else {
                        console2.log(
                            "  Bad Debt: %8e",
                            (usdCollateralAndDebt.userUsdDebt
                                    - usdCollateralAndDebt.userUsdCollateral)
                        );
                    }
                    badDebt += (usdCollateralAndDebt.userUsdDebt
                            - usdCollateralAndDebt.userUsdCollateral);
                    console2.log("    - Borrowed tokens: ");
                    for (uint256 i = 0; i < usdCollateralAndDebt.debtTokens.length; i++) {
                        if (usdCollateralAndDebt.debtTokens[i] != address(0)) {
                            console2.log(
                                "      * %s: %8e",
                                IERC20Detailed(usdCollateralAndDebt.debtTokens[i]).symbol(),
                                (usdCollateralAndDebt.debtAmount[i] * 1e8) / 10
                                    ** IERC20Detailed(usdCollateralAndDebt.debtTokens[i]).decimals()
                            );
                            if (
                                users[idx] != 0xcd69567080Dccad1Afe61aCc022c0A7164B29AB4
                                    && users[idx] != 0x9520C9040338bE61005590cC1BD15caa10a6613c
                                    && users[idx] != 0x1D0A98B5daB763FaC9dd4d3d0FE7ada18DBb3535
                                    && users[idx] != 0x510A269A93736B5B5E3C2133e8f2e7D829ca3Fec
                                    && users[idx] != 0xA27eBF925Ec2D1db0cB6b5CAbDab108F71fa6b53
                                    && users[idx] != 0x08ef8C80eBcFCb6a3D1460657c55042cEd5F45D3
                                    && users[idx] != 0x76F844359ffBe267F4c02ffD76184e27b1AeBE6B
                                    && users[idx] != 0x9B3020F0cABc4bA0346cce5FC02e7Cf681E0e227
                                    && users[idx] != 0x9c57F65aB8c45E52128ea6630615f54E3038a4bd
                            ) {
                                debtAssetSum[
                                    usdCollateralAndDebt.debtTokens[i]
                                ] += usdCollateralAndDebt.debtAmount[i];
                            }
                        }
                    }
                    console2.log("    - Provided tokens: ");
                    for (uint256 i = 0; i < usdCollateralAndDebt.collateralTokens.length; i++) {
                        if (usdCollateralAndDebt.collateralTokens[i] != address(0)) {
                            console2.log(
                                "      * %s: %8e",
                                IERC20Detailed(usdCollateralAndDebt.collateralTokens[i]).symbol(),
                                (usdCollateralAndDebt.collateralAmount[i] * 1e8) / 10
                                    ** IERC20Detailed(usdCollateralAndDebt.collateralTokens[i])
                                        .decimals()
                            );

                            if (
                                users[idx] != 0xcd69567080Dccad1Afe61aCc022c0A7164B29AB4
                                    && users[idx] != 0x9520C9040338bE61005590cC1BD15caa10a6613c
                                    && users[idx] != 0x1D0A98B5daB763FaC9dd4d3d0FE7ada18DBb3535
                                    && users[idx] != 0x510A269A93736B5B5E3C2133e8f2e7D829ca3Fec
                                    && users[idx] != 0xA27eBF925Ec2D1db0cB6b5CAbDab108F71fa6b53
                                    && users[idx] != 0x08ef8C80eBcFCb6a3D1460657c55042cEd5F45D3
                                    && users[idx] != 0x76F844359ffBe267F4c02ffD76184e27b1AeBE6B
                                    && users[idx] != 0x9B3020F0cABc4bA0346cce5FC02e7Cf681E0e227
                                    && users[idx] != 0x9c57F65aB8c45E52128ea6630615f54E3038a4bd
                            ) {
                                collateralAssetSum[
                                    usdCollateralAndDebt.collateralTokens[i]
                                ] += usdCollateralAndDebt.collateralAmount[i];
                            }
                        }
                    }
                    if (
                        users[idx] != 0xcd69567080Dccad1Afe61aCc022c0A7164B29AB4
                            && users[idx] != 0x9520C9040338bE61005590cC1BD15caa10a6613c
                            && users[idx] != 0x1D0A98B5daB763FaC9dd4d3d0FE7ada18DBb3535
                            && users[idx] != 0x510A269A93736B5B5E3C2133e8f2e7D829ca3Fec
                            && users[idx] != 0xA27eBF925Ec2D1db0cB6b5CAbDab108F71fa6b53
                            && users[idx] != 0x08ef8C80eBcFCb6a3D1460657c55042cEd5F45D3
                            && users[idx] != 0x76F844359ffBe267F4c02ffD76184e27b1AeBE6B
                            && users[idx] != 0x9B3020F0cABc4bA0346cce5FC02e7Cf681E0e227
                            && users[idx] != 0x9c57F65aB8c45E52128ea6630615f54E3038a4bd
                    ) {
                        badDebtExcludingHacker += (usdCollateralAndDebt.userUsdDebt
                                - usdCollateralAndDebt.userUsdCollateral);
                    }
                } else {
                    console2.log("  Bad Debt: 0");
                }
            }
        }

        console2.log("---------------------------------------");
        console2.log("Block number: ", block.number);
        console2.log("FINAL BAD DEBT: %8e", badDebt);
        console2.log("FINAL BAD DEBT excluding hacker: %8e", badDebtExcludingHacker);
        console2.log("Number of users with bad debt: ", numberOfUsersWithBadDebt);
        console2.log(
            "Number of users with liquidity greater than 50 cents: ",
            numberOfUsersWithLiquidityGreaterThan50Cents
        );
        console2.log("---------------------------------------");
        (address[] memory reserveList,) = IMiniPool(miniPool).getReservesList();
        IAERC6909 erc6909 = IAERC6909(
            IMiniPoolAddressesProvider(MINI_POOL_ADDRESS_PROVIDER).getMiniPoolToAERC6909(miniPool)
        );
        for (uint256 idx = 0; idx < reserveList.length; idx++) {
            (,, bool isTranched) = erc6909.getIdForUnderlying(reserveList[idx]);
            if (isTranched) {
                console2.log(
                    "Total borrowed (excluding hacker) for %s : %8e",
                    IERC20Detailed(IAToken(reserveList[idx]).UNDERLYING_ASSET_ADDRESS()).symbol(),
                    (debtAssetSum[IAToken(reserveList[idx]).UNDERLYING_ASSET_ADDRESS()] * 1e8) / 10
                        ** IERC20Detailed(IAToken(reserveList[idx]).UNDERLYING_ASSET_ADDRESS())
                            .decimals()
                );
                console2.log(
                    "Collateral liquidity associated with bad debt(excluding hacker) for %s : %8e",
                    IERC20Detailed(IAToken(reserveList[idx]).UNDERLYING_ASSET_ADDRESS()).symbol(),
                    (collateralAssetSum[IAToken(reserveList[idx]).UNDERLYING_ASSET_ADDRESS()] * 1e8)
                        / 10
                        ** IERC20Detailed(IAToken(reserveList[idx]).UNDERLYING_ASSET_ADDRESS())
                            .decimals()
                );
            } else {
                console2.log(
                    "Total borrowed (excluding hacker) for %s : %8e",
                    IERC20Detailed(reserveList[idx]).symbol(),
                    (debtAssetSum[reserveList[idx]] * 1e8) / 10
                        ** IERC20Detailed(reserveList[idx]).decimals()
                );
                console2.log(
                    "Collateral liquidity associated with bad debt (excluding hacker) for %s : %8e",
                    IERC20Detailed(reserveList[idx]).symbol(),
                    (collateralAssetSum[reserveList[idx]] * 1e8) / 10
                        ** IERC20Detailed(reserveList[idx]).decimals()
                );
            }
        }
        console2.log("---------------------------------------");
    }

    function testAnalyseUsers() public {
        /**
         * 0xE7a2c97601076065C3178BDbb22C61933f850B03
         *     0x0baFB30B72925e6d53F4d0A089bE1CeFbB5e3401
         *     0x65559abECD1227Cc1779F500453Da1f9fcADd928
         *     0x52280eA8979d52033E14df086F4dF555a258bEb4
         */
        // console2.log("________________ LST MINI POOL __________________");
        // analyzeUsers(lstUsers, 0x0baFB30B72925e6d53F4d0A089bE1CeFbB5e3401);
        console2.log("________________ REX33 MINI POOL __________________");
        analyzeUsers(rex33Users, 0x65559abECD1227Cc1779F500453Da1f9fcADd928);
        // console2.log("________________ LINEA MINI POOL __________________");
        // analyzeUsers(lineaUsers, 0x52280eA8979d52033E14df086F4dF555a258bEb4);
    }

    function testBadDebtLineaMiniPool() public {
        address[] memory users = lineaUsers;
        address miniPool = 0x52280eA8979d52033E14df086F4dF555a258bEb4;
        analyzeBadDebt(users, miniPool);
    }

    function testDayAgoBadDebtLineaMiniPooll() public {
        string memory lineaRpc = vm.envString("LINEA_RPC_URL");
        uint256 lineaFork = vm.createSelectFork(lineaRpc, (25302377 - 1 days));
        assertEq(vm.activeFork(), lineaFork);
        liquidator = new Liquidator();

        address[] memory users = lineaUsers;
        address miniPool = 0x52280eA8979d52033E14df086F4dF555a258bEb4;
        analyzeBadDebt(users, miniPool);
    }

    function testBadDebtRex33MiniPool() public {
        address[] memory users = rex33Users;
        address miniPool = 0x65559abECD1227Cc1779F500453Da1f9fcADd928;
        analyzeBadDebt(users, miniPool);
    }

    function testDayAgoBadDebtRex33MiniPool() public {
        string memory lineaRpc = vm.envString("LINEA_RPC_URL");
        uint256 lineaFork = vm.createSelectFork(lineaRpc, (25302377 - 12 hours));
        assertEq(vm.activeFork(), lineaFork);
        liquidator = new Liquidator();

        address[] memory users = rex33Users;
        address miniPool = 0x65559abECD1227Cc1779F500453Da1f9fcADd928;
        analyzeBadDebt(users, miniPool);
    }

    function testEtherexSwap() public {
        address etherexFactory = 0xC0b920f6f1d6122B8187c031554dc8194F644592;
        address etherexPool = 0x7b930713103A964c12E8b808c83F57E40d9ad495;
        IRouter etherexRouter = IRouter(0x32dB39c56C171b4c96e974dDeDe8E42498929c54);
        uint256 usdcAmount = 44_000e6; // 17_000e6
        IRouter.route[] memory routes = new IRouter.route[](1);
        routes[0] = IRouter.route(USDC, ASUSD, true);

        vm.prank(etherexFactory);
        IPair(etherexPool).setFee(1000); // 500000 -> 50% -- 5000 -> 0.5%

        (uint256 amount, bool stable) = etherexRouter.getAmountOut(1e6, USDC, ASUSD);
        console2.log("1. Current ratio: %18e", amount);
        vm.startPrank(ADMIN);
        uint256 initialBalanceOfAsUsd = IERC20Detailed(ASUSD).balanceOf(ADMIN);
        uint256 initialBalanceOfUsdc = IERC20Detailed(USDC).balanceOf(ADMIN);

        IERC20Detailed(USDC).approve(address(etherexRouter), usdcAmount);
        console2.log("Swapping %6e of USDC: ", usdcAmount);
        etherexRouter.swapExactTokensForTokens(usdcAmount, 0, routes, ADMIN, block.timestamp + 10);
        (amount, stable) = etherexRouter.getAmountOut(1e6, USDC, ASUSD);
        console2.log("2. Current ratio: %18e", amount);

        console2.log(
            "Balance change for asUSD +%18e ",
            IERC20Detailed(ASUSD).balanceOf(ADMIN) - initialBalanceOfAsUsd
        );
        console2.log(
            "Balance change for USDC -%6e ",
            initialBalanceOfUsdc - IERC20Detailed(USDC).balanceOf(ADMIN)
        );

        console2.log("Imitate selling pressure: 40 000 asUSD ... ");
        routes = new IRouter.route[](1);
        routes[0] = IRouter.route(ASUSD, USDC, true);
        IERC20Detailed(ASUSD).approve(address(etherexRouter), 40_000e18);
        etherexRouter.swapExactTokensForTokens(40_000e18, 0, routes, ADMIN, block.timestamp + 10);
        (amount, stable) = etherexRouter.getAmountOut(1e6, USDC, ASUSD);
        console2.log("3. Current ratio: %18e", amount);

        usdcAmount = 31_000e6;
        routes[0] = IRouter.route(USDC, ASUSD, true);
        IERC20Detailed(USDC).approve(address(etherexRouter), usdcAmount);
        console2.log("Swapping %6e of USDC: ", usdcAmount);
        etherexRouter.swapExactTokensForTokens(usdcAmount, 0, routes, ADMIN, block.timestamp + 10);
        (amount, stable) = etherexRouter.getAmountOut(1e6, USDC, ASUSD);
        console2.log("4. Current ratio: %18e", amount);
        vm.stopPrank();
    }

    function testAtBlockEtherexSwap() public {
        string memory lineaRpc = vm.envString("LINEA_RPC_URL");
        uint256 lineaFork = vm.createSelectFork(lineaRpc, 25745523);
        assertEq(vm.activeFork(), lineaFork);
        address etherexFactory = 0xC0b920f6f1d6122B8187c031554dc8194F644592;
        address etherexPool = 0x7b930713103A964c12E8b808c83F57E40d9ad495;
        IRouter etherexRouter = IRouter(0x32dB39c56C171b4c96e974dDeDe8E42498929c54);
        uint256 usdcAmount = 57_000e6; // 17_000e6
        IRouter.route[] memory routes = new IRouter.route[](1);
        routes[0] = IRouter.route(USDC, ASUSD, true);

        vm.prank(etherexFactory);
        IPair(etherexPool).setFee(1000); // 500000 -> 50% -- 5000 -> 0.5%

        (uint256 amount, bool stable) = etherexRouter.getAmountOut(1e6, USDC, ASUSD);
        console2.log("1. Current ratio: %18e", amount);
        vm.startPrank(ADMIN);
        uint256 initialBalanceOfAsUsd = IERC20Detailed(ASUSD).balanceOf(ADMIN);
        uint256 initialBalanceOfUsdc = IERC20Detailed(USDC).balanceOf(ADMIN);

        IERC20Detailed(USDC).approve(address(etherexRouter), usdcAmount);
        console2.log("Swapping %6e of USDC: ", usdcAmount);
        etherexRouter.swapExactTokensForTokens(usdcAmount, 0, routes, ADMIN, block.timestamp + 10);
        (amount, stable) = etherexRouter.getAmountOut(1e6, USDC, ASUSD);
        console2.log("2. Current ratio: %18e", amount);

        console2.log(
            "Balance change for asUSD +%18e ",
            IERC20Detailed(ASUSD).balanceOf(ADMIN) - initialBalanceOfAsUsd
        );
        console2.log(
            "Balance change for USDC -%6e ",
            initialBalanceOfUsdc - IERC20Detailed(USDC).balanceOf(ADMIN)
        );
        vm.stopPrank();
    }

    DataTypes.ReserveConfigurationMap configuration;

    function testAllReservesAvailableInProtocol() public {
        uint256 allAssetsToBorrowInUsd = 0;
        console2.log("\n========== CURRENT BALANCE ANALYSIS ==========\n");
        IOracle oracle = IOracle(ORACLE);

        (address[] memory reserves,) = ILendingPool(LENDING_POOL_PROXY).getReservesList();
        uint256 totalUSD = 0;
        uint256 asUsdProvided = 0;
        for (uint256 idx = 0; idx < reserves.length; idx++) {
            uint256 currentBalance = IERC20Detailed(reserves[idx]).balanceOf(reserves[idx]);
            uint256 valueInUsd = (currentBalance * oracle.getAssetPrice(reserves[idx])) / 10
                ** IERC20Detailed(reserves[idx]).decimals();

            if (
                keccak256(bytes(IERC20Detailed(reserves[idx]).symbol()))
                    == keccak256(bytes("asUSD"))
            ) {
                DataTypes.ReserveData memory reserveData =
                    ILendingPool(LENDING_POOL_PROXY).getReserveData(reserves[idx], false);
                asUsdProvided = IERC20Detailed(reserveData.aTokenAddress).balanceOf(ADMIN) / 10
                    ** (IERC20Detailed(reserveData.aTokenAddress).decimals() - 8);
            } else {
                DataTypes.ReserveData memory reserveData =
                    ILendingPool(LENDING_POOL_PROXY).getReserveData(reserves[idx], true);
                configuration = reserveData.configuration;
                if (valueInUsd * 10_000 / configuration.getLtv() > 2e8) {
                    console2.log(
                        "[LENDING_POOL] %s | Balance: %s | USD Value: %8e",
                        IERC20Detailed(reserves[idx]).symbol(),
                        currentBalance,
                        valueInUsd
                    );
                    console2.log(
                        "  --> LTV Adjusted: %s | USD: %8e",
                        currentBalance * 10_000 / configuration.getLtv(),
                        valueInUsd * 10_000 / configuration.getLtv()
                    );
                    allAssetsToBorrowInUsd += valueInUsd;
                    totalUSD += valueInUsd * 10_000 / configuration.getLtv();
                }
            }
        }

        console2.log("  Total asUSD Needed: %8e", totalUSD);
        console2.log("  asUSD Provided: %8e", asUsdProvided);
        if (asUsdProvided < totalUSD) {
            console2.log("  >>> Deficit: %8e asUSD to provide\n", totalUSD - asUsdProvided);
        } else {
            console2.log("  >>> Surplus - No additional asUSD needed\n");
        }
        console2.log("\n========== MINI POOLS ANALYSIS ==========\n");
        for (uint256 i = 0; i < 4; i++) {
            address erc6909 =
                (IMiniPoolAddressesProvider(MINI_POOL_ADDRESS_PROVIDER).getMiniPoolToAERC6909(i));
            IMiniPool miniPool =
                IMiniPool(IMiniPoolAddressesProvider(MINI_POOL_ADDRESS_PROVIDER).getMiniPool(i));
            (reserves,) = miniPool.getReservesList();
            miniPoolToBalances[erc6909] = new uint256[](reserves.length);
            totalUSD = 0;
            asUsdProvided = 0;
            console2.log(">>> MINI_POOL #%s", i);
            for (uint256 idx = 0; idx < reserves.length; idx++) {
                miniPoolToBalances[erc6909][idx] = IERC20Detailed(reserves[idx]).balanceOf(erc6909);
                uint256 tmpBalance = IERC20Detailed(reserves[idx]).balanceOf(erc6909);
                uint256 valueInUsd = (tmpBalance * oracle.getAssetPrice(reserves[idx])) / 10
                    ** IERC20Detailed(reserves[idx]).decimals();
                DataTypes.MiniPoolReserveData memory reserveData =
                    miniPool.getReserveData(reserves[idx]);

                if (
                    keccak256(bytes(IERC20Detailed(reserves[idx]).symbol()))
                        == keccak256(bytes("asUSD"))
                ) {
                    (uint256 id,,) =
                        IAERC6909(reserveData.aErc6909).getIdForUnderlying(reserves[idx]);
                    asUsdProvided = IAERC6909(reserveData.aErc6909).balanceOf(ADMIN, id) / 10
                        ** (IAERC6909(reserveData.aErc6909).decimals(id) - 8);
                } else {
                    configuration = reserveData.configuration;
                    if (valueInUsd * 10_000 / configuration.getLtv() > 2e8) {
                        console2.log(
                            "  [%s] Balance: %s | USD: %8e",
                            IERC20Detailed(reserves[idx]).symbol(),
                            tmpBalance,
                            valueInUsd
                        );
                        console2.log(
                            "    --> LTV Adjusted: %s | USD: %8e",
                            tmpBalance * 10_000 / configuration.getLtv(),
                            valueInUsd * 10_000 / configuration.getLtv()
                        );
                    }

                    allAssetsToBorrowInUsd += valueInUsd;
                    totalUSD += valueInUsd * 10_000 / configuration.getLtv();
                }
            }
            console2.log("  Total asUSD Needed: %8e", totalUSD);
            console2.log("  asUSD Provided: %8e", asUsdProvided);
            if (asUsdProvided < totalUSD) {
                console2.log("  >>> Deficit: %8e asUSD to provide\n", totalUSD - asUsdProvided);
            } else {
                console2.log("  >>> Surplus - No additional asUSD needed\n");
            }
            console2.log("All assets to borrow in USD: %8e", allAssetsToBorrowInUsd);
        }
    }

    function testBorrowEverything() public {
        /**
         * 0xE7a2c97601076065C3178BDbb22C61933f850B03
         *     0x0baFB30B72925e6d53F4d0A089bE1CeFbB5e3401
         *     0x65559abECD1227Cc1779F500453Da1f9fcADd928
         *     0x52280eA8979d52033E14df086F4dF555a258bEb4
         */
        uint256 lendingPoolAmount = 1060e18;
        uint256 miniPool1Amount = 9300e18;

        // Unpause
        vm.startPrank(EMERGENCY);
        ILendingPoolConfigurator(LENDING_POOL_CONFIGURATOR).setPoolPause(false);
        // IMiniPoolConfigurator(MINI_POOL_CONFIGURATOR)
        //     .setPoolPause(false, IMiniPool(0xE7a2c97601076065C3178BDbb22C61933f850B03));
        IMiniPoolConfigurator(MINI_POOL_CONFIGURATOR)
            .setPoolPause(false, IMiniPool(0x0baFB30B72925e6d53F4d0A089bE1CeFbB5e3401));
        IMiniPoolConfigurator(MINI_POOL_CONFIGURATOR)
            .setPoolPause(false, IMiniPool(0x65559abECD1227Cc1779F500453Da1f9fcADd928));
        IMiniPoolConfigurator(MINI_POOL_CONFIGURATOR)
            .setPoolPause(false, IMiniPool(0x52280eA8979d52033E14df086F4dF555a258bEb4));
        vm.stopPrank();

        vm.startPrank(ADMIN);
        // Enable borrowing
        // LendingPool
        // ILendingPoolConfigurator(LENDING_POOL_CONFIGURATOR).enableBorrowingOnReserve(WBTC, true);
        // ILendingPoolConfigurator(LENDING_POOL_CONFIGURATOR).enableBorrowingOnReserve(WETH, true);
        // ILendingPoolConfigurator(LENDING_POOL_CONFIGURATOR).enableBorrowingOnReserve(USDC, true);
        // ILendingPoolConfigurator(LENDING_POOL_CONFIGURATOR).enableBorrowingOnReserve(USDT, true);
        // ILendingPoolConfigurator(LENDING_POOL_CONFIGURATOR).enableBorrowingOnReserve(MUSD, true);
        // // Unfreeze
        // ILendingPoolConfigurator(LENDING_POOL_CONFIGURATOR).unfreezeReserve(USDT, true);

        // IERC20Detailed(ASUSD).approve(LENDING_POOL_PROXY, lendingPoolAmount); // LENDING POOL
        // ILendingPool(LENDING_POOL_PROXY).deposit(ASUSD, false, lendingPoolAmount, ADMIN);
        // // // Borrow lending pool
        // // ILendingPool(LENDING_POOL_PROXY).borrow(WBTC, true, 3312, ADMIN);
        // // ILendingPool(LENDING_POOL_PROXY).borrow(WETH, true, 6006584470294208, ADMIN);
        // // ILendingPool(LENDING_POOL_PROXY).borrow(USDT, true, 895531866, ADMIN);

        // // Mini pool #0
        // // IMiniPoolConfigurator(MINI_POOL_CONFIGURATOR)
        // //     .enableBorrowingOnReserve(
        // //         wasWBTC, IMiniPool(0xE7a2c97601076065C3178BDbb22C61933f850B03)
        // //     );
        // // IMiniPoolConfigurator(MINI_POOL_CONFIGURATOR)
        // //     .enableBorrowingOnReserve(
        // //         wasWETH, IMiniPool(0xE7a2c97601076065C3178BDbb22C61933f850B03)
        // //     );
        // IMiniPoolConfigurator(MINI_POOL_CONFIGURATOR)
        //     .enableBorrowingOnReserve(
        //         wasUSDC, IMiniPool(0xE7a2c97601076065C3178BDbb22C61933f850B03)
        //     );
        // IMiniPoolConfigurator(MINI_POOL_CONFIGURATOR)
        //     .enableBorrowingOnReserve(
        //         wasUSDT, IMiniPool(0xE7a2c97601076065C3178BDbb22C61933f850B03)
        //     );
        // // IMiniPoolConfigurator(MINI_POOL_CONFIGURATOR)
        // //     .enableBorrowingOnReserve(MUSD, IMiniPool(0xE7a2c97601076065C3178BDbb22C61933f850B03));
        // // Unfreeze
        // IMiniPoolConfigurator(MINI_POOL_CONFIGURATOR)
        //     .unfreezeReserve(wasUSDT, IMiniPool(0xE7a2c97601076065C3178BDbb22C61933f850B03));
        // // Borrow Mini pool #0
        // IMiniPool(0xE7a2c97601076065C3178BDbb22C61933f850B03).borrow(wasUSDC, true, 22901206, ADMIN);
        // IMiniPool(0xE7a2c97601076065C3178BDbb22C61933f850B03).borrow(wasUSDT, true, 9004528, ADMIN);

        // +++++++++++++++++++++++++++++++ Mini pool #1 ++++++++++++++++++++++++
        (
            uint256 totalCollateralETH,
            uint256 totalDebtETH,
            uint256 availableBorrowsETH,
            uint256 currentLiquidationThreshold,
            uint256 ltv,
            uint256 healthFactor
        ) = IMiniPool(0x0baFB30B72925e6d53F4d0A089bE1CeFbB5e3401).getUserAccountData(ADMIN);
        console2.log(
            "totalCollateralETH %8e vs totalDebtETH: %8e", totalCollateralETH, totalDebtETH
        );
        console2.log(
            "healthFactor %18e vs availableBorrowsETH: %8e", healthFactor, availableBorrowsETH
        );

        IMiniPoolConfigurator(MINI_POOL_CONFIGURATOR)
            .enableBorrowingOnReserve(
                wasWETH, IMiniPool(0x0baFB30B72925e6d53F4d0A089bE1CeFbB5e3401)
            );

        IMiniPoolConfigurator(MINI_POOL_CONFIGURATOR)
            .enableBorrowingOnReserve(MUSD, IMiniPool(0x0baFB30B72925e6d53F4d0A089bE1CeFbB5e3401));
        IMiniPoolConfigurator(MINI_POOL_CONFIGURATOR)
            .enableBorrowingOnReserve(WSTETH, IMiniPool(0x0baFB30B72925e6d53F4d0A089bE1CeFbB5e3401));
        // Unfreeze
        // IMiniPoolConfigurator(MINI_POOL_CONFIGURATOR)
        //     .unfreezeReserve(wasUSDT, IMiniPool(0x0baFB30B72925e6d53F4d0A089bE1CeFbB5e3401));
        console2.log("------------------ Balances before---------------");
        uint256[] memory balancesBefore = checkBalances(0x0baFB30B72925e6d53F4d0A089bE1CeFbB5e3401);

        IERC20Detailed(ASUSD).approve(0x0baFB30B72925e6d53F4d0A089bE1CeFbB5e3401, miniPool1Amount); // MINI_POOL #1
        IMiniPool(0x0baFB30B72925e6d53F4d0A089bE1CeFbB5e3401)
            .deposit(ASUSD, true, miniPool1Amount, ADMIN);

        // Borrow Mini pool #1
        IMiniPool(0x0baFB30B72925e6d53F4d0A089bE1CeFbB5e3401)
            .borrow(wasWETH, true, 55140268597812244, ADMIN);
        IMiniPool(0x0baFB30B72925e6d53F4d0A089bE1CeFbB5e3401)
            .borrow(WSTETH, false, 4234545948972649259, ADMIN);
        IMiniPool(0x0baFB30B72925e6d53F4d0A089bE1CeFbB5e3401).borrow(MUSD, false, 13000000, ADMIN);

        console2.log("------------------ Balances after---------------");
        uint256[] memory balancesAfter = checkBalances(0x0baFB30B72925e6d53F4d0A089bE1CeFbB5e3401);
        calculateDiffs(0x0baFB30B72925e6d53F4d0A089bE1CeFbB5e3401, balancesBefore, balancesAfter);

        // +++++++++++++++++++++++++++++++ Mini pool #2 +++++++++++++++++++++++++++++++
        IMiniPoolConfigurator(MINI_POOL_CONFIGURATOR)
            .enableBorrowingOnReserve(
                wasWETH, IMiniPool(0x65559abECD1227Cc1779F500453Da1f9fcADd928)
            );
        IMiniPoolConfigurator(MINI_POOL_CONFIGURATOR)
            .enableBorrowingOnReserve(
                wasUSDC, IMiniPool(0x65559abECD1227Cc1779F500453Da1f9fcADd928)
            );
        IMiniPoolConfigurator(MINI_POOL_CONFIGURATOR)
            .enableBorrowingOnReserve(MUSD, IMiniPool(0x65559abECD1227Cc1779F500453Da1f9fcADd928));
        IMiniPoolConfigurator(MINI_POOL_CONFIGURATOR)
            .enableBorrowingOnReserve(LINEA, IMiniPool(0x65559abECD1227Cc1779F500453Da1f9fcADd928));
        IMiniPoolConfigurator(MINI_POOL_CONFIGURATOR)
            .enableBorrowingOnReserve(REX33, IMiniPool(0x65559abECD1227Cc1779F500453Da1f9fcADd928));

        // Borrow Mini pool #2
        console2.log("------------------ Balances before---------------");
        balancesBefore = checkBalances(0x65559abECD1227Cc1779F500453Da1f9fcADd928);

        IMiniPool(0x65559abECD1227Cc1779F500453Da1f9fcADd928)
            .borrow(wasWETH, true, 647590930145388047, ADMIN);
        IMiniPool(0x65559abECD1227Cc1779F500453Da1f9fcADd928)
            .borrow(REX33, false, 839854248479358621297583, ADMIN);
        IMiniPool(0x65559abECD1227Cc1779F500453Da1f9fcADd928)
            .borrow(wasUSDC, true, 5494404886, ADMIN);
        IMiniPool(0x65559abECD1227Cc1779F500453Da1f9fcADd928).borrow(MUSD, false, 44641799, ADMIN);
        IMiniPool(0x65559abECD1227Cc1779F500453Da1f9fcADd928)
            .borrow(LINEA, false, 115675048273683903952149, ADMIN);

        console2.log("------------------ Balances after---------------");
        balancesAfter = checkBalances(0x65559abECD1227Cc1779F500453Da1f9fcADd928);
        calculateDiffs(0x65559abECD1227Cc1779F500453Da1f9fcADd928, balancesBefore, balancesAfter);

        // +++++++++++++++++++++++++++++++ Mini pool #3 +++++++++++++++++++++++++++++++

        IMiniPoolConfigurator(MINI_POOL_CONFIGURATOR)
            .enableBorrowingOnReserve(
                wasWETH, IMiniPool(0x52280eA8979d52033E14df086F4dF555a258bEb4)
            );
        IMiniPoolConfigurator(MINI_POOL_CONFIGURATOR)
            .enableBorrowingOnReserve(
                wasUSDC, IMiniPool(0x52280eA8979d52033E14df086F4dF555a258bEb4)
            );

        IMiniPoolConfigurator(MINI_POOL_CONFIGURATOR)
            .enableBorrowingOnReserve(MUSD, IMiniPool(0x52280eA8979d52033E14df086F4dF555a258bEb4));
        IMiniPoolConfigurator(MINI_POOL_CONFIGURATOR)
            .enableBorrowingOnReserve(LINEA, IMiniPool(0x52280eA8979d52033E14df086F4dF555a258bEb4));

        // Borrow Mini pool #3

        console2.log("------------------ Balances before---------------");
        balancesBefore = checkBalances(0x52280eA8979d52033E14df086F4dF555a258bEb4);

        IMiniPool(0x52280eA8979d52033E14df086F4dF555a258bEb4)
            .borrow(wasWETH, true, 409890009518812055, ADMIN);
        IMiniPool(0x52280eA8979d52033E14df086F4dF555a258bEb4)
            .borrow(wasUSDC, true, 15982755219, ADMIN);
        IMiniPool(0x52280eA8979d52033E14df086F4dF555a258bEb4).borrow(MUSD, false, 302521464, ADMIN);
        IMiniPool(0x52280eA8979d52033E14df086F4dF555a258bEb4)
            .borrow(LINEA, false, 3064798600988115042034005, ADMIN);

        console2.log("------------------ Balances after---------------");
        balancesAfter = checkBalances(0x52280eA8979d52033E14df086F4dF555a258bEb4);
        calculateDiffs(0x52280eA8979d52033E14df086F4dF555a258bEb4, balancesBefore, balancesAfter);
        vm.stopPrank();
    }

    function calculateDiffs(
        address miniPool,
        uint256[] memory balancesBefore,
        uint256[] memory balancesAfter
    ) internal {
        (address[] memory reserves,) = IMiniPool(miniPool).getReservesList();
        for (uint256 i = 0; i < balancesAfter.length; i++) {
            if (balancesAfter[i] >= balancesBefore[i]) {
                console2.log(
                    "%s Diff: %8e",
                    IERC20Detailed(reserves[i]).symbol(),
                    (balancesAfter[i] - balancesBefore[i]) * 1e8 / 10
                        ** IERC20Detailed(reserves[i]).decimals()
                );
            } else {
                console2.log(
                    "%s Diff: -%8e",
                    IERC20Detailed(reserves[i]).symbol(),
                    (balancesBefore[i] - balancesAfter[i]) * 1e8 / 10
                        ** IERC20Detailed(reserves[i]).decimals()
                );
            }
        }
    }

    function checkBalances(address miniPool) internal returns (uint256[] memory balances) {
        IMiniPool _miniPool = IMiniPool(miniPool);
        (address[] memory reserves,) = _miniPool.getReservesList();
        balances = new uint256[](reserves.length);
        for (uint256 idx = 0; idx < reserves.length; idx++) {
            DataTypes.MiniPoolReserveData memory reserveData =
                _miniPool.getReserveData(reserves[idx]);
            (uint256 id,,) = IAERC6909(reserveData.aErc6909).getIdForUnderlying(reserves[idx]);
            uint256 balance = IAERC6909(reserveData.aErc6909).balanceOf(ADMIN, id);
            console2.log(
                "Remaining balance for %s: %s", IERC20Detailed(reserves[idx]).symbol(), balance
            );
            if (id >= 1128) {
                balances[idx] = IERC20Detailed(reserves[idx]).balanceOf(ADMIN);
                console2.log(
                    "Balance of %s: %s", IERC20Detailed(reserves[idx]).symbol(), balances[idx]
                );
            } else {
                balances[idx] = IERC20Detailed(IAToken(reserves[idx]).UNDERLYING_ASSET_ADDRESS())
                    .balanceOf(ADMIN);
                console2.log(
                    "Balance of %s: %s",
                    IERC20Detailed(IAToken(reserves[idx]).UNDERLYING_ASSET_ADDRESS()).symbol(),
                    balances[idx]
                );
            }
        }
        return balances;
    }

    function withdrawAll(address miniPool) internal {
        // address erc6909 =
        //     (IMiniPoolAddressesProvider(MINI_POOL_ADDRESS_PROVIDER).getMiniPoolToAERC6909(miniPool));
        IMiniPool _miniPool = IMiniPool(miniPool);
        (address[] memory reserves,) = _miniPool.getReservesList();
        // miniPoolToBalances[erc6909] = new uint256[](reserves.length);

        for (uint256 idx = 0; idx < reserves.length; idx++) {
            DataTypes.MiniPoolReserveData memory reserveData =
                _miniPool.getReserveData(reserves[idx]);
            (uint256 id,,) = IAERC6909(reserveData.aErc6909).getIdForUnderlying(reserves[idx]);
            uint256 balance = IAERC6909(reserveData.aErc6909).balanceOf(ADMIN, id);
            console2.log(
                "_________Balance of %s: %8e (id: %s)_________",
                IERC20Detailed(reserves[idx]).symbol(),
                (balance * 1e8) / 10 ** IERC20Detailed(reserves[idx]).decimals(),
                id
            );
            // / (10 ** IAERC6909(reserveData.aErc6909).decimals(id));
            if (
                keccak256(bytes(IERC20Detailed(reserves[idx]).symbol()))
                    != keccak256(bytes("asUSD"))
            ) {
                uint256 availableLiquidity =
                    IERC20Detailed(reserves[idx]).balanceOf(reserveData.aErc6909);
                uint256 toWithdraw = 0;
                console2.log(
                    "Available liquidity: %8e",
                    (availableLiquidity * 1e8) / 10 ** IERC20Detailed(reserves[idx]).decimals()
                );
                if (availableLiquidity > balance) {
                    toWithdraw = balance;
                } else {
                    toWithdraw = availableLiquidity;
                }

                if (toWithdraw > 0) {
                    if (id >= 1128) {
                        console2.log(
                            "Withdraw(%s, false, %s, 0x7D66a2e916d79c0988D41F1E50a1429074ec53a4",
                            reserves[idx],
                            toWithdraw
                        );
                        _miniPool.withdraw(reserves[idx], false, toWithdraw, ADMIN);
                    } else {
                        console2.log(IERC20Detailed(reserves[idx]).symbol());
                        console2.log(
                            "Withdraw(%s, true, %s, 0x7D66a2e916d79c0988D41F1E50a1429074ec53a4",
                            reserves[idx],
                            toWithdraw
                        );
                        _miniPool.withdraw(reserves[idx], true, toWithdraw, ADMIN);
                    }
                }
            }
        }
    }
}
